<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Iteration, Iteration, Iteration, Iter</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    About
  </a>
</li>
<li>
  <a href="syllabus.html">
    <span class="fa fa-map fa-1x"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Set Up
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="computer_setup.html">Computer Setup</a>
    </li>
    <li>
      <a href="setting_up_git.html">Setting up Git Repository</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book  fa-1x"></span>
     
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_01_intro_r_rstudio.html">Intro to Programming, R, &amp; RStudio</a>
    </li>
    <li>
      <a href="lesson_02_project_management.html">Project Management</a>
    </li>
    <li>
      <a href="lesson_03_how_r_thinks_about_data.html">How R Thinks About Data</a>
    </li>
    <li>
      <a href="lesson_04_spreadsheets_condensed.html">Spreadsheets</a>
    </li>
    <li>
      <a href="lesson_05_data_import.html">Starting With Spreadsheets in R</a>
    </li>
    <li>
      <a href="lesson_06_data_manipulation_pt1.html">Data Manipulation Pt1</a>
    </li>
    <li>
      <a href="lesson_08_data_manipulation_pt2.html">Data Manipulation Pt2</a>
    </li>
    <li>
      <a href="lesson_09_data_viz_pt1.html">Data Visualization Pt1</a>
    </li>
    <li>
      <a href="lesson_11_data_viz_pt2.html">Data Visualization Pt2</a>
    </li>
    <li>
      <a href="lesson_12_lubridate.html">Date-times with lubridate</a>
    </li>
    <li>
      <a href="lesson_13_functions.html">Writing functions</a>
    </li>
    <li>
      <a href="lesson_14_iteration.html">Iteration</a>
    </li>
    <li>
      <a href="lesson_rmarkdown.html">Literate Programming with RMarkdown</a>
    </li>
  </ul>
</li>
<li>
  <a href="lectures.html">
    <span class="fa fa-slideshare fa-1x"></span>
     
    Lectures
  </a>
</li>
<li>
  <a href="assignments.html">
    <span class="fa fa-paperclip fa-1x"></span>
     
    Assignments
  </a>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-list"></span>
     
    Resources
  </a>
</li>
<li>
  <a href="appointments.html">
    <span class="fa fa-list"></span>
     
    Appointments
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://github.com/gge-ucd/R-DAVIS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Iteration, Iteration, Iteration, Iter</h1>

</div>


<br>
<div id="learning-objectives" class="section level2 blue">
<h2>Learning objectives</h2>
<ul>
<li>Understand when and why to iterate code</li>
<li>Be able to start with a single use and build up to iteration</li>
<li>Use for loops, apply functions, and purrr to iterate</li>
<li>Be able to write functions to cleanly iterate code</li>
</ul>
</div>
<p><br></p>
<div id="once-twice-thrice-in-a-lifetime" class="section level2">
<h2><del>Once</del> <del>Twice</del> Thrice in a Lifetime</h2>
<p>And you may find yourself<br> Behind the keys of a large computing machine<br> And you may find yourself<br> Copy-pasting tons of code<br> And you may ask yourself, well<br> How did I get here?</p>
<p><img src="img/david_byrne_once.gif" width="250" /></p>
<p><br></p>
<p>It’s pretty common that you’ll want to run the same basic bit of code a bunch of times with different inputs. Maybe you want to read in a bunch of data files with different names or calculate something complex on every row of a dataframe. A general rule of thumb is that any code you want to run 3+ times should be iterated instead of copy-pasted. Copy-pasting code and replacing the parts you want to change is generally a bad practice for several reasons:</p>
<ul>
<li>it’s easy to forget to change all the parts that need to be different</li>
<li>it’s easy to mistype</li>
<li>it is ugly to read</li>
<li>it scales very poorly (try copy-pasting 100 times…)</li>
</ul>
<p>Lots of functions (including many <code>base</code> functions) are <em>vectorized</em>, meaning they already work on vectors of values. Here’s an example:</p>
<pre class="r"><code>x &lt;- 1:10
log(x)</code></pre>
<pre><code>##  [1] 0.0000000 0.6931472 1.0986123 1.3862944 1.6094379 1.7917595 1.9459101 2.0794415 2.1972246 2.3025851</code></pre>
<p>The <code>log()</code> function already knows we want to take the log of each element in x, and it returns a vector that’s the same length as x. If a <em>vectorized</em> function already exists to do what you want, use it! It’s going to be faster and cleaner than trying to iterate everything yourself.</p>
<p>However, we may want to do more complex iterations, which brings us to our first main iterating concept.</p>
</div>
<div id="for-loops" class="section level2">
<h2>For Loops</h2>
<p>A for loop will repeat some bit of code, each time with a new input value. Here’s the basic structure:</p>
<pre class="r"><code>for(i in 1:10) {
  print(i)
}</code></pre>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
## [1] 9
## [1] 10</code></pre>
<p>You’ll often see <code>i</code> used in for loops, you can think of it as the iteration value. For each <code>i</code> value in the vector 1:10, we’ll print that index value. You can use the <code>i</code> value more than once in a loop:</p>
<pre class="r"><code>for (i in 1:10) {
  print(i)
  print(i^2)
}</code></pre>
<pre><code>## [1] 1
## [1] 1
## [1] 2
## [1] 4
## [1] 3
## [1] 9
## [1] 4
## [1] 16
## [1] 5
## [1] 25
## [1] 6
## [1] 36
## [1] 7
## [1] 49
## [1] 8
## [1] 64
## [1] 9
## [1] 81
## [1] 10
## [1] 100</code></pre>
<p>What’s happening is the value of <code>i</code> gets inserted into the code block, the block gets run, the value of <code>i</code> changes, and the process repeats. For loops can be a way to explicitly lay out fairly complicated procedures, since you can see exactly where your <code>i</code> value is going in the code.</p>
<p>You can also use the <code>i</code> value to index a vector or dataframe, which can be very powerful!</p>
<pre class="r"><code>for (i in 1:10) {
  print(letters[i])
  print(mtcars$wt[i])
}</code></pre>
<pre><code>## [1] &quot;a&quot;
## [1] 2.62
## [1] &quot;b&quot;
## [1] 2.875
## [1] &quot;c&quot;
## [1] 2.32
## [1] &quot;d&quot;
## [1] 3.215
## [1] &quot;e&quot;
## [1] 3.44
## [1] &quot;f&quot;
## [1] 3.46
## [1] &quot;g&quot;
## [1] 3.57
## [1] &quot;h&quot;
## [1] 3.19
## [1] &quot;i&quot;
## [1] 3.15
## [1] &quot;j&quot;
## [1] 3.44</code></pre>
<p>Here we printed out the first 10 letters of the alphabet from the <code>letters</code> vector, as well as the first 10 car weights from the <code>mtcars</code> dataframe.</p>
<p>If you want to store your results somewhere, it is important that you create an empty object to hold them <strong>before</strong> you run the loop. If you grow your results vector one value at a time, it will be much slower. Here’s how to make that empty vector first. We’ll also use the function <code>seq_along</code> to create a sequence that’s the proper length, instead of explicitly writing out something like <code>1:10</code>.</p>
<pre class="r"><code>results &lt;- rep(NA, nrow(mtcars))

for (i in seq_along(mtcars$wt)) {
  results[i] &lt;- mtcars$wt[i] * 1000
}
results</code></pre>
<pre><code>##  [1] 2620 2875 2320 3215 3440 3460 3570 3190 3150 3440 3440 4070 3730 3780 5250 5424 5345 2200 1615 1835 2465
## [22] 3520 3435 3840 3845 1935 2140 1513 3170 2770 3570 2780</code></pre>
</div>
<div id="purrr" class="section level2">
<h2><code>purrr</code></h2>
<p>For loops are very handy and important to understand, but they can involve writing a lot of code and can generally look fairly messy.</p>
<p>The <code>tidyverse</code> includes another way to iterate, using the <code>map</code> family of functions. These functions all do the same basic thing: take a series of values and apply a function to each of them. That function could be a function from a package, or it could be one you write to do something specific.</p>
<p>For a wonderful and thorough exploration of the <code>purrr</code> package, check out <a href="https://jennybc.github.io/purrr-tutorial/">Jenny Brian’s tutorial</a>.</p>
<div id="map" class="section level3">
<h3><code>map</code></h3>
<p>When using the <code>map</code> family of functions, the first argument (as in all tidyverse functions) is the data. One nice feature is that you can specify the format of the output explicitly by using a different member of the family.</p>
<pre class="r"><code>mtcars %&gt;% map(mean) # gives a list</code></pre>
<pre><code>## $mpg
## [1] 20.09062
## 
## $cyl
## [1] 6.1875
## 
## $disp
## [1] 230.7219
## 
## $hp
## [1] 146.6875
## 
## $drat
## [1] 3.596563
## 
## $wt
## [1] 3.21725
## 
## $qsec
## [1] 17.84875
## 
## $vs
## [1] 0.4375
## 
## $am
## [1] 0.40625
## 
## $gear
## [1] 3.6875
## 
## $carb
## [1] 2.8125</code></pre>
<pre class="r"><code>mtcars %&gt;% map_dbl(mean) # gives a numeric vector</code></pre>
<pre><code>##        mpg        cyl       disp         hp       drat         wt       qsec         vs         am 
##  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250  17.848750   0.437500   0.406250 
##       gear       carb 
##   3.687500   2.812500</code></pre>
<pre class="r"><code>mtcars %&gt;% map_chr(mean) # gives a character vector</code></pre>
<pre><code>##          mpg          cyl         disp           hp         drat           wt         qsec           vs 
##  &quot;20.090625&quot;   &quot;6.187500&quot; &quot;230.721875&quot; &quot;146.687500&quot;   &quot;3.596563&quot;   &quot;3.217250&quot;  &quot;17.848750&quot;   &quot;0.437500&quot; 
##           am         gear         carb 
##   &quot;0.406250&quot;   &quot;3.687500&quot;   &quot;2.812500&quot;</code></pre>
</div>
<div id="additonal-arguments" class="section level3">
<h3>Additonal Arguments</h3>
<p>You can pass additional arguments to functions that you map across your data. For example, if you have some NAs in your data, you might want to use <code>mean()</code> with <code>na.rm = TRUE</code>.</p>
<pre class="r"><code>mtcars2 &lt;- mtcars # make a copy of the mtcars dataset
mtcars2[3,c(1,6,8)] &lt;- NA # make one of the cars have NAs for several columns
mtcars2</code></pre>
<pre><code>##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710            NA   4 108.0  93 3.85    NA 18.61 NA  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<pre class="r"><code>mtcars2 %&gt;% map_dbl(mean) # returns NA for mpg, wt, and vs columns</code></pre>
<pre><code>##        mpg        cyl       disp         hp       drat         wt       qsec         vs         am 
##         NA   6.187500 230.721875 146.687500   3.596563         NA  17.848750         NA   0.406250 
##       gear       carb 
##   3.687500   2.812500</code></pre>
<pre class="r"><code>mtcars2 %&gt;% map_dbl(mean, na.rm = TRUE)</code></pre>
<pre><code>##         mpg         cyl        disp          hp        drat          wt        qsec          vs          am 
##  20.0032258   6.1875000 230.7218750 146.6875000   3.5965625   3.2461935  17.8487500   0.4193548   0.4062500 
##        gear        carb 
##   3.6875000   2.8125000</code></pre>
</div>
<div id="map2" class="section level3">
<h3><code>map2</code></h3>
<p>You can use the <code>map2</code> series of functions if you need to map across two sets of inputs in parallel. Here, we’ll map across both the names of cars and their mpg values, using an anonymous function to paste the two together into a sentence.</p>
<p>We’ll use what’s called an “anonymous function”, which is a small function we define within the <code>map</code> function call. Our function will take 2 arguments, x and y, and paste them together with some other text.</p>
<pre class="r"><code>map2_chr(rownames(mtcars), mtcars$mpg, function(x,y) paste(x, &quot;gets&quot;, y, &quot;miles per gallon&quot;)) %&gt;% 
  head()</code></pre>
<pre><code>## [1] &quot;Mazda RX4 gets 21 miles per gallon&quot;           &quot;Mazda RX4 Wag gets 21 miles per gallon&quot;      
## [3] &quot;Datsun 710 gets 22.8 miles per gallon&quot;        &quot;Hornet 4 Drive gets 21.4 miles per gallon&quot;   
## [5] &quot;Hornet Sportabout gets 18.7 miles per gallon&quot; &quot;Valiant gets 18.1 miles per gallon&quot;</code></pre>
<p>You can use the <code>pmap</code> series of functions if you need to use more than two input lists.</p>
</div>
</div>
<div id="complete-workflow" class="section level2">
<h2>Complete Workflow</h2>
<p>Let’s try working through a complete example of how you might iterate a more complex operation across a dataset. This will follow 3 basic steps:</p>
<ol style="list-style-type: decimal">
<li>Write code that does the thing you want <strong>once</strong></li>
<li>Generalize that code into a function that can take different inputs</li>
<li>Apply that function across your data</li>
</ol>
<div id="starting-with-a-single-case" class="section level3">
<h3>Starting With a Single Case</h3>
<p>The first thing we’ll do is figure out if we can do the right thing once! We want to rescale a vector of values to a 0-1 scale. We’ll try it out on the weights in <code>mtcars</code>. Our heaviest vehicle will have a scaled weight of 1, and our lightest will have a scaled weight of 0. We’ll do this by taking our weight, subtracting the minimum car weight from it, and dividing this by the range of the car weights (max minus min). We’ll have to be careful about our order of operations…</p>
<pre class="r"><code>(mtcars$wt[1] - min(mtcars$wt, na.rm = T)) /
  (max(mtcars$wt, na.rm = T) - min(mtcars$wt, na.rm = T))</code></pre>
<pre><code>## [1] 0.2830478</code></pre>
<p>Great! We got a scaled value out of the deal. Because we’re working with base functions like <code>max</code>, <code>min</code>, and <code>/</code>, we can vectorize. This means we can give it the whole weight vector, and we’ll get a whole scaled vector back.</p>
<pre class="r"><code>mtcars$wt_scaled &lt;- (mtcars$wt - min(mtcars$wt, na.rm = T)) /
  diff(range(mtcars$wt, na.rm = T))

mtcars$wt_scaled</code></pre>
<pre><code>##  [1] 0.28304781 0.34824853 0.20634109 0.43518282 0.49271286 0.49782664 0.52595244 0.42879059 0.41856303
## [10] 0.49271286 0.49271286 0.65379698 0.56686269 0.57964715 0.95551010 1.00000000 0.97980056 0.17565840
## [19] 0.02608029 0.08233188 0.24341601 0.51316799 0.49143442 0.59498849 0.59626694 0.10790079 0.16031705
## [28] 0.00000000 0.42367681 0.32140118 0.52595244 0.32395807</code></pre>
</div>
<div id="generalizing" class="section level3">
<h3>Generalizing</h3>
<p>Now let’s replace our reference to a specific vector of data with something generic: <code>x</code>. This code won’t run on its own, since <code>x</code> doesn’t have a value, but it’s just showing how we would refer to some generic value.</p>
<pre class="r"><code>x_scaled &lt;- (x - min(x, na.rm = T)) /
  diff(range(x, na.rm = T))</code></pre>
</div>
<div id="making-it-a-function" class="section level3">
<h3>Making it a Function</h3>
<p>Now that we’ve got a generalized bit of code, we can turn it into a function. All we need is a name, <code>function</code>, and a list of arguments. In this case, we’ve just got one argument: <code>x</code>.</p>
<pre class="r"><code>rescale_0_1 &lt;- function(x) {
  (x - min(x, na.rm = T)) /
  diff(range(x, na.rm = T))
}

rescale_0_1(mtcars$mpg) # it works on one of our columns</code></pre>
<pre><code>##  [1] 0.4510638 0.4510638 0.5276596 0.4680851 0.3531915 0.3276596 0.1659574 0.5957447 0.5276596 0.3744681
## [11] 0.3148936 0.2553191 0.2936170 0.2042553 0.0000000 0.0000000 0.1829787 0.9361702 0.8510638 1.0000000
## [21] 0.4723404 0.2170213 0.2042553 0.1234043 0.3744681 0.7191489 0.6638298 0.8510638 0.2297872 0.3957447
## [31] 0.1957447 0.4680851</code></pre>
</div>
<div id="iterating" class="section level3">
<h3>Iterating!</h3>
<p>Now that we’ve got a function that’ll rescale a vector of values, we can use one of the <code>map</code> functions to iterate across all the columns in a dataframe, rescaling each one. We’ll use <code>map_df</code> since it returns a dataframe, and we’re feeding it a dataframe.</p>
<pre class="r"><code>map_df(mtcars, rescale_0_1)</code></pre>
<pre><code>## # A tibble: 32 × 12
##      mpg   cyl   disp     hp  drat    wt  qsec    vs    am  gear  carb wt_scaled
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 0.451   0.5 0.222  0.205  0.525 0.283 0.233     0     1   0.5 0.429     0.283
##  2 0.451   0.5 0.222  0.205  0.525 0.348 0.3       0     1   0.5 0.429     0.348
##  3 0.528   0   0.0920 0.145  0.502 0.206 0.489     1     1   0.5 0         0.206
##  4 0.468   0.5 0.466  0.205  0.147 0.435 0.588     1     0   0   0         0.435
##  5 0.353   1   0.721  0.435  0.180 0.493 0.3       0     0   0   0.143     0.493
##  6 0.328   0.5 0.384  0.187  0     0.498 0.681     1     0   0   0         0.498
##  7 0.166   1   0.721  0.682  0.207 0.526 0.160     0     0   0   0.429     0.526
##  8 0.596   0   0.189  0.0353 0.429 0.429 0.655     1     0   0.5 0.143     0.429
##  9 0.528   0   0.174  0.152  0.535 0.419 1         1     0   0.5 0.143     0.419
## 10 0.374   0.5 0.241  0.251  0.535 0.493 0.452     1     0   0.5 0.429     0.493
## # … with 22 more rows</code></pre>
<p>There you have it! We went from some code that calculated one value to being able to iterate it across any number of columns in a dataframe. It can be tempting to jump straight to your final iteration code, but it’s often better to start simple and work your way up, verifying that things work at each step, especially if you’re trying to do something even moderately complex.</p>
</div>
</div>
<div id="apply-functions" class="section level2">
<h2><code>apply</code> Functions</h2>
<p>While we learned the <code>tidyverse</code> series of <code>map</code> functions, it’s worth mentioning that there is a similar series of packages in base R called the <code>apply</code> series of functions. They are very similar to <code>map</code> functions, but the syntax is a little different and you have to be a little more careful about the data types you put in and get out.</p>
<p>We’re not going to go into the <code>apply</code> family, but if you want to learn more, <a href="https://www.guru99.com/r-apply-sapply-tapply.html">here is a good tutorial</a>. You might come across the <code>apply</code> functions in someone else’s code, so it’s good to know they exist.</p>
<p>This lesson was contributed by Michael Culshaw-Maurer, with ideas from Mike Koontz and Brandon Hurr’s <a href="http://d-rug.github.io/blog/2017/Brandon-Hurr-on-using-map-and-walk">D-RUG presentation</a>.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data visualization</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    About
  </a>
</li>
<li>
  <a href="syllabus.html">
    <span class="fa fa-map fa-1x"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Set Up!
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="computer_setup.html">Computer Setup</a>
    </li>
    <li>
      <a href="setting_up_git.html">Setting up Git Repository</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book  fa-1x"></span>
     
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_intro_r_rstudio.html">Orientation to Programming, R, &amp; RStudio</a>
    </li>
    <li>
      <a href="lesson_project_management.html">Project Management</a>
    </li>
    <li>
      <a href="http://www.datacarpentry.org/spreadsheet-ecology-lesson/">Spreadsheets</a>
    </li>
    <li>
      <a href="http://www.datacarpentry.org/R-ecology-lesson/01-intro-to-r.html#vectors_and_data_types">Vectors &amp; Data Types</a>
    </li>
    <li>
      <a href="lesson_data_frames_continents.html">Data frames (continents)</a>
    </li>
    <li>
      <a href="lesson_data_frames_ecology.html">Data frames (ecology)</a>
    </li>
    <li>
      <a href="lesson_dplyr_ecology.html">Using dplyr (ecology)</a>
    </li>
    <li>
      <a href="lesson_dplyr_gapminder.html">Using dplyr (gapminder)</a>
    </li>
    <li>
      <a href="lesson_visualization_ggplot2.html">Using ggplot2 (gapminder)</a>
    </li>
    <li>
      <a href="http://www.datacarpentry.org/R-ecology-lesson/04-visualization-ggplot2.html">Using ggplot2 (ecology)</a>
    </li>
    <li>
      <a href="lesson_visualization_dos.html">Visualization Do's &amp; Don'ts</a>
    </li>
    <li>
      <a href="lesson_rmarkdown.html">Literate Programming with RMarkdown</a>
    </li>
    <li>
      <a href="lesson_data_import.html">Data import &amp; export</a>
    </li>
    <li>
      <a href="lesson_tidyr.html">Using tidyr</a>
    </li>
    <li>
      <a href="lesson_joins.html">Joining data</a>
    </li>
    <li>
      <a href="lesson_import_dplyr_ggplot2.html">Pipelines: data import %&gt;% dplyr %&gt;% ggplot2</a>
    </li>
    <li>
      <a href="lesson_ice_core_CO2_web_data.html">Pipelines: Download CO2 &amp; Ice Core Data &amp; Visualize</a>
    </li>
    <li>
      <a href="lesson_lubridate.html">Times &amp; Dates with lubridate</a>
    </li>
    <li>
      <a href="lesson_functions.html">Writing functions</a>
    </li>
    <li>
      <a href="lesson_for_loops.html">For loops</a>
    </li>
    <li>
      <a href="lesson_purrr_tutorial.html">Using purrr</a>
    </li>
    <li>
      <a href="https://ryanpeek.github.io/mapping_in_R/index.html">
        <span class="fa fa-map fa-1.5x"></span>
         
        Mapping in R
      </a>
    </li>
    <li>
      <a href="lesson_text_mining_mlk.html">Text mining</a>
    </li>
    <li>
      <a href="lesson_github_collaboration.html">Github collaboration with branches</a>
    </li>
    <li>
      <a href="http://www.datacarpentry.org/R-ecology-lesson/05-r-and-databases.html">R and SQL</a>
    </li>
  </ul>
</li>
<li>
  <a href="lectures.html">
    <span class="fa fa-slideshare fa-1x"></span>
     
    Lectures
  </a>
</li>
<li>
  <a href="assignments.html">
    <span class="fa fa-paperclip fa-1x"></span>
     
    Assignments
  </a>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-list"></span>
     
    Resources
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://github.com/gge-ucd/R-DAVIS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Data visualization</h1>

</div>


<blockquote>
<h2 id="learning-objectives">Learning objectives</h2>
<ul>
<li>To be able to use ggplot2 to generate publication quality graphics</li>
<li>To understand the basics of the grammar of graphics:
<ul>
<li>The aesthetics layer</li>
<li>The geometry layer(s)</li>
<li>Adding statistics</li>
<li>Transforming scales</li>
<li>Modifying geom aesthetics by color/shape/size/linetype</li>
<li>Faceting</li>
</ul></li>
</ul>
</blockquote>
<p>Plotting is essential to understanding your data and the relationships in it. You should be making plots throughout the analysis and modeling process. There are three main plotting systems in R, the base plotting system, the lattice package, and the ggplot2 package.</p>
<p>We will learn <code>ggplot()</code>, because it is effective and efficient, makes publication-quality graphics, and is theoretically grounded in the grammar of graphics– the idea that any plot can be expressed from the same set of components: a <strong>data</strong> set, a <strong>coordinate system</strong>, and a set of <strong>geoms</strong>–the visual representation of data points.</p>
<p>The <code>ggplot2</code> package is automatically installed with the <code>tidyverse</code> package, so it will be loaded when we call the <code>library()</code> function on <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div id="first-plots" class="section level3">
<h3>First plots</h3>
<p>The key to understanding ggplot is thinking about a figure in layers: just like you might do in an image editing program like Photoshop, Illustrator, or Inkscape.</p>
<p>Let’s start off with an example, longevity as a function of gdp:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/lifeExp-vs-gdpPercap-scatter-1.png" width="672" /></p>
<p>The first thing we do is call the <code>ggplot</code> function. This function tells ggplot what dataset we’re using (gapminder) and how to map variables in gapminder to the plotting “canvas” (gdp to the x-axis, life expectancy to the y-axis). That <strong>mapping</strong> of variables to plot elements is done through the <code>aes</code> function. Arguments to <code>aes</code> will be variable names from the <code>data.frame</code> passed to <code>ggplot</code>. If you need a reminder of what’s in our data.frame, use <code>str(gapminder)</code>.</p>
<p>By itself, the call to <code>ggplot</code> isn’t enough to draw a figure. This sets up the canvas correctly, but it doesn’t draw anything on it.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp))</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Now we need to tell <code>ggplot</code> how to draw the data. For that, we add another layer: a <strong>geom</strong>. In our example, we used <code>geom_point</code>, which tells <code>ggplot</code> we want to draw a point for each row in the dataset.</p>
<p>Note that we tell R that multiple lines belong to <code>ggplot</code> by including a <code>+</code> at the end of each line except the last.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/lifeExp-vs-gdpPercap-scatter2-1.png" width="672" /></p>
<blockquote>
<h4 id="challenge-changing-a-variable">Challenge – Changing a variable</h4>
<p>Modify the following code to make a figure that shows how life expectancy has changed over time:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">geom_point</span>()</a></code></pre></div>
<p>Hint: Inspect the data with <code>head(gapminder)</code> or <code>str(gapminder)</code> to find the name of the variable representing time. It should go on the x-axis.</p>
<p><strong>Bonus</strong>: So far, we have only mapped variables to the <strong>x</strong> and <strong>y</strong> locations of each point. Another <em>aesthetic</em> property we can modify is the point <code>color</code>. Modify the code from the previous challenge to <strong>color</strong> the points by the “continent” column. What trends do you see in the data? Are they what you expected?</p>
</blockquote>
</div>
<div id="layers" class="section level3">
<h3>Layers</h3>
<p>Using a scatterplot probably isn’t the best for visualizing change over time. Let’s add another layer to the plot – lines connecting the points representing each country:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">color =</span> continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/lifeExp-line-bad-1.png" width="672" /></p>
<p>Hmm, that’s not quite right. What has happened there? How many lines are there?</p>
<p>The lines are grouped by continent. We wanted one line per country, but we got one line per continent because we mapped continent to color and <code>ggplot</code> assumes we want to group by the coloring variable unless we tell it otherwise. To get one line per country we tell ggplot explicitly to group by country. Just like the other aesthetic mappings, that goes in the <code>aes()</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, </a>
<a class="sourceLine" id="cb7-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">color =</span> continent, <span class="dt">group =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/lifeExp-line-1.png" width="672" /></p>
<p>Note that aesthetic mappings in the top-line <code>ggplot</code> call apply to all layers, but you can also map variables just within a single layer. For example, if we want colored lines but black points, we can move the mapping of continent-to-color from the <code>ggplot</code> line to the <code>geom_line</code>, so that it no longer applies to <code>geom_point</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">group =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent))</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/lifeExp-line-2-1.png" width="672" /></p>
<p>Note that each layer is drawn on top of the previous layer. If we want the points on top of the lines, we can move <code>geom_point</code> to after <code>geom_line</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y=</span>lifeExp, <span class="dt">by=</span>country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/lifeExp-layer-example-1-1.png" width="672" /></p>
</div>
<div id="continuous-vs.discrete-variables" class="section level3">
<h3>Continuous vs. discrete variables</h3>
<p>The plots we have done so far have plotted numeric variables to both axes. What if we want to plot a numeric variable against a categorical variable, such as continent.</p>
<p><strong>Shoutout Q: What kind of plot can we use to plot a continuous variable </strong> <strong>versus a categorical variable, say life expectency by continent?</strong></p>
<blockquote>
<p>NB: A barchart (or, less likely, a dotchart) is suboptimal because it requires summarizing the data to the mean or median or whatever – we’d rather preserve the information present in the full distribution.</p>
</blockquote>
<p>One possibility is a boxplot. In a boxplot, the distribution of values for each category is displayed, with the central line at the median value, the box representing the inner-50%, etc.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> continent, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<blockquote>
<h4 id="challenge-a-new-geom">Challenge – A new geom</h4>
<p>Violin plots are an alternative to boxplots that present the entire distribution of the continuous variable.</p>
<ul>
<li>Can you change the last plot from a boxplot to a violin plot?</li>
<li>Can you color each violin by its continent? - Tip: Try out the <code>fill</code> aesthetic.</li>
</ul>
<p><strong>Bonus</strong>: Suppose you want to examine the distribution of life expectencies across all countries together; that is, you want a single plot of showing the distribution of all life-expectancy values. There are a few geom’s that can do this: Can you make one?</p>
</blockquote>
</div>
<div id="transformations" class="section level3">
<h3>Transformations</h3>
<p>The grammar of graphics makes it easy to transform the scales on which the data are presented. To demonstrate we’ll go back to our first example:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() </a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/lifeExp-vs-gdpPercap-scatter3-1.png" width="672" /></p>
<p>Currently it’s hard to see the relationship between the points due to some strong outliers in GDP per capita. We can change the scale of units on the x-axis using the <em>scale</em> functions. These control the mapping between the data values and visual values of an aesthetic.</p>
<p>The <code>log10</code> function applies a transformation to the values of the <code>gdpPercap</code> column before rendering them on the plot, so that each multiple of 10 now only corresponds to an increase in 1 on the transformed scale, e.g. a GDP per capita of 1,000 is now 3 on the x-axis, a value of 10,000 corresponds to 4 on the x-axis and so on. This makes it easier to visualize the spread of data on the x-axis.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/axis-scale-1.png" width="672" /></p>
</div>
<div id="adding-models" class="section level3">
<h3>Adding models</h3>
<p>We can fit a simple, linear relationship to the data by adding another layer, <code>geom_smooth</code>, which adds a summary of a fit model to the plot. <code>method = 'lm'</code> tells <code>geom_smooth</code> to fit a <strong>l</strong>inear <strong>m</strong>odel. We could also fit other, more flexible smoothers by specifying different methods in <code>geom_smooth</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>)</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/lm-fit-1.png" width="672" /></p>
<blockquote>
<h4 id="challenge-the-power-of-money-by-continent">Challenge – The power of money, by continent</h4>
<ul>
<li>Modify the last plot to color points by continent and get a separate fit-line for each continent.</li>
<li>Tip: This can be done in one place, with fewer than 20 characters.</li>
<li><strong>Bonus</strong>: Color the points by continent, but have only one line, fit to all of the data.</li>
</ul>
</blockquote>
</div>
<div id="adjust-appearances" class="section level3">
<h3>Adjust appearances</h3>
<p>Some people like the gray <code>ggplot</code> background, others call it “chart junk” – distracting, uninformative ink. You can change the overall appearance of a plot by setting a new theme. E.g. <code>theme_bw</code> is a bit cleaner:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="st">    </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/themes-1.png" width="672" /></p>
<p>There are a variety of themes in a separate package called <code>ggthemes</code>, e.g. we can mimic The Economist <a href="https://github.com/jrnold/ggthemes">or many others</a>. Of course before we use the <code>ggthemes</code> package, we have to install it, which you can do with <code>install.packages('ggthemes')</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">library</span>(ggthemes)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ggthemes&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:cowplot&#39;:
## 
##     theme_map</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="st">    </span><span class="kw">theme_economist</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/ggthemes-1.png" width="672" /></p>
<div id="changing-fixed-aspects-of-plots" class="section level4">
<h4>Changing fixed aspects of plots</h4>
<p>Of course, rather than changing the theme of an entire plot, we often want to changes some specific aspect of it. Let’s make our linear model line black instead of blue and dashed instead of solid, and let’s make our points smaller.</p>
<p>Note that when aesthetics are mapped from a variable, they go in <code>aes()</code>, but to set them to a fixed value, they go outside <code>aes()</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">y =</span> lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent), <span class="dt">size =</span> <span class="fl">.25</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="st">    </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<blockquote>
<h4 id="challenge-sizing-points" class="challenge">Challenge – sizing points</h4>
<p>Modify the previous plot to size the points in proportion to the population of the county.</p>
</blockquote>
</div>
</div>
<div id="multi-panel-figures" class="section level3">
<h3>Multi-panel figures</h3>
<p>Earlier we visualized the change in life expectancy over time across all countries in one plot.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">by =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent))</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>That’s a mess! It’s hard to see patterns because there is so much information on top of itself. We can split this out over multiple panels by adding another layer: <strong>facet</strong> panels. The <code>facet_wrap</code> layer takes a “formula” as its argument, denoted by the tilde (~). You can read this as “by continent”. It tells R to draw a panel for each unique value of continent.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">by =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent)</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/facet-1.png" width="672" /></p>
</div>
<div id="modifying-text" class="section level3">
<h3>Modifying text</h3>
<p>To clean this figure up for a publication we need to change some of the text elements. The x-axis is way too cluttered, and the axis labels should read “Life expectancy” and “Year”, rather than the column name in the data frame. Also, the country names don’t fit in the strips at the top of each plot, and we might like to add an overall title to the figure.</p>
<p>We can do this by adding a few new layers. The <code>xlab</code> and <code>ylab</code> layers control the names of the x and y axes. The <strong>theme</strong> layer is where we change lots of minor details of a plot. here we’ll rotate the axis text (with <code>angle</code>) so that they’ll fit, and then make sure they’re lined up right with <code>vjust</code> for vertical-adjustment. And let’s add a plot title for fun; we can do that with <code>ggtitle</code> layer.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">by =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Life expectancy&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="st">    </span><span class="kw">scale_color_brewer</span>(<span class="dt">guide =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">270</span>, <span class="dt">vjust =</span> <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&#39;Life expectancy over time by country&#39;</span>)</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/cleaned%20up-1.png" width="672" /></p>
</div>
<div id="saving-plots" class="section level3">
<h3>Saving plots</h3>
<p>Now that we have that plot just the way we want it, let’s write it to disk as an image. Of course, we could regenerate it by re-running our script, but we might want to make it available separately to show a collaborator or include in a document or presentation.</p>
<p>You can use the <code>ggsave</code> function to save a ggplot. By default, <code>ggave</code> will save the last generated plot in the same dimensions as your viewing pane. The only required argument to <code>ggsave</code> is the location of the file you want to write to. Using our project organization, let’s write the last plot to <code>results/lifeExpByCountry.png</code>. <code>ggsave</code> will notices the extension of the filename and writes the file in that format. You can also save as .pdf, .jpg, and other file types.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">ggsave</span>(<span class="st">&#39;results/lifeExpByYear.png&#39;</span>)</a></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<p>Some of the country names are still getting squeezed, so let’s make the canvas a little bigger, and we’ll save a pdf file instead of a png. Let’s also assign our plot to an object and explicitly save that plot to disk. You assign a ggplot object to a variable just like any other object.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">myplot &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">by =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>continent) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Life expectancy&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">14</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="st">    </span><span class="kw">scale_color_brewer</span>(<span class="dt">guide =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">270</span>, <span class="dt">vjust =</span> <span class="fl">.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&#39;Life expectancy over time by country&#39;</span>)</a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&#39;results/lifeExpByYear-bigger.pdf&#39;</span>, </a>
<a class="sourceLine" id="cb25-12" data-line-number="12">       <span class="dt">plot =</span> myplot, </a>
<a class="sourceLine" id="cb25-13" data-line-number="13">       <span class="dt">width =</span> <span class="dv">12</span>, <span class="dt">height =</span> <span class="dv">8</span>)</a></code></pre></div>
</div>
<div id="wrap-up" class="section level3">
<h3>Wrap-up</h3>
<p>This is just a taste of what you can do with <code>ggplot2</code>. RStudio provides a really useful <a href="http://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">cheat sheet</a> of the different layers available, and more extensive documentation is available on the <a href="http://docs.ggplot2.org/current/">ggplot2 website</a>. Finally, if you have no idea how to change something, a quick Google search will usually send you to a relevant question and answer on Stack Overflow with reusable code to modify!</p>
<blockquote>
<h4 id="challenge-5">Challenge 5</h4>
<p>Create a density plot of GDP per capita, with a separate curve for each continent, with color filled by continent. Save the plot to your <code>results/</code> directory.</p>
<p><strong>Advanced</strong>:</p>
<ul>
<li>Adjust the opacity (<code>alpha</code>) of the density curves so all are visible.</li>
<li>Transform the-x axis to better visualize the data spread.</li>
<li>Add a facet layer to panel the density plots by year.</li>
</ul>
</blockquote>
</div>
<div id="challenge-solutions" class="section level2">
<h2>Challenge solutions</h2>
<blockquote>
<h4 id="solution-to-challenge-1">Solution to challenge 1</h4>
<p>Modify the example so that the figure visualize how life expectancy has changed over time:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/ch1-sol-1.png" width="672" /></p>
</blockquote>
<blockquote>
<h4 id="solution-to-challenge-2">Solution to challenge 2</h4>
<p>In the previous examples and challenge we’ve used the <code>aes</code> function to tell the scatterplot <strong>geom</strong> about the <strong>x</strong> and <strong>y</strong> locations of each point. Another <em>aesthetic</em> property we can modify is the point <em>color</em>. Modify the code from the previous challenge to <strong>color</strong> the points by the “continent” column. What trends do you see in the data? Are they what you expected?</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> lifeExp, <span class="dt">color=</span>continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/ch2-sol-1.png" width="672" /></p>
</blockquote>
<blockquote>
<h4 id="solution-to-challenge-3">Solution to challenge 3</h4>
<p>Switch the order of the point and line layers from the previous example. What happened?</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x=</span>year, <span class="dt">y=</span>lifeExp, <span class="dt">by=</span>country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span>continent))</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/ch3-sol-1.png" width="672" /></p>
<p>The lines now get drawn over the points!</p>
</blockquote>
<blockquote>
<h4 id="solution-to-challenge-4">Solution to challenge 4</h4>
<p>Modify the color and size of the points on the point layer in the previous example.</p>
<p>Hint: do not use the <code>aes</code> function.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> lifeExp, <span class="dt">y =</span> gdpPercap)) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">size=</span><span class="fl">1.5</span>)</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/ch4-sol-1.png" width="672" /></p>
</blockquote>
<blockquote>
<h4 id="solution-to-challenge-5">Solution to challenge 5</h4>
<p>Create a density plot of GDP per capita, filled by continent.</p>
<p>Advanced: - Transform the x axis to better visualize the data spread. - Add a facet layer to panel the density plots by year.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> gdpPercap, <span class="dt">fill=</span>continent)) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span><span class="fl">0.6</span>) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>year) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<p><img src="lesson_visualization_ggplot2_files/figure-html/ch5-sol-1.png" width="672" /></p>
</blockquote>
</div>
<div id="from-the-dplyr-lesson" class="section level1">
<h1>From the dplyr lesson</h1>
<blockquote>
<h4 id="challenge-part-3-advanced">Challenge – Part 3 (Advanced)</h4>
<p>The above plotting exercise asked you to plot summarized information, but it is generally preferable to avoid summarizing before plotting. Can you generate a plot that shows the information you calculated in Part 1 without summarizing?</p>
<ul>
<li>Hint: <code>ggplot</code> interprets the <code>gapminder$year</code> as a numeric variable, which may be okay, but there are some plot types for which you need <code>ggplot</code> to see <code>gapminder$year</code> as a category. You can accomplish this by wrapping it in <code>factor</code> – e.g. <code>ggplot(gapminder, aes(x = factor(year) ...</code></li>
</ul>
</blockquote>
<div id="resources" class="section level4">
<h4>Resources</h4>
<p>That is the core of <code>dplyr</code>’s functionality, but it does more. RStudio makes a great <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheatsheet</a> that covers all the <code>dplyr</code> functions we just learned, plus what we will learn in the next lesson: keeping data tidy.</p>
<!-- ## Challenge solutions -->
<!-- > #### Solution to challenge Subsetting {.challenge} -->
<!-- > -->
<!-- > - Subset the gapminder data to only Oceania countries post-1980. -->
<!-- > - Remove the continent column -->
<!-- > - Make a scatter plot of gdpPercap vs. population colored by country -->
<!-- > -->
<!-- > ```{r challenge subsetting a} -->
<!-- > oc1980 = filter(gapminder, continent == "Oceania" & year > 1980) -->
<!-- > oc1980less = select(oc1980, -continent) -->
<!-- > library('ggplot2') -->
<!-- > ggplot(oc1980less, aes(x = gdpPercap, y = lifeExp, color = country)) + -->
<!-- >   geom_point() -->
<!-- > ``` -->
<!-- > -->
<!-- > **Advanced** How would you determine the median population for the North  -->
<!-- > American countries between 1970 and 1980? -->
<!-- > -->
<!-- > ```{r challenge subsettingB} -->
<!-- > noAm = filter(gapminder, country == "United States" |  -->
<!-- >                 country == "Canada" | country == "Mexico" |  -->
<!-- >                 country == "Puerto Rico" & (year > 1970 & year < 1980) -->
<!-- >               ) -->
<!-- > noAmPop = select(noAm, pop) -->
<!-- > median(noAmPop) -->
<!-- > noAmPop -->
<!-- > as.integer(noAmPop) -->
<!-- > median(unlist(noAmPop)) -->
<!-- > ``` -->
<!-- > -->
<!-- > **Bonus** This can be done using base R's subsetting, but this class doesn't  -->
<!-- > teach how. Do the original challenge without the `filter` and `select`  -->
<!-- > functions. Feel free to consult Google, helpfiles, etc. to figure out how. -->
<!-- > -->
<!-- > ```{r challenge subsettingC} -->
<!-- > noAm2 = gapminder[(gapminder$country == "United States") | -->
<!-- >                     (gapminder$country == "Mexico") | -->
<!-- >                     (gapminder$country == "Canada") | -->
<!-- >                     (gapminder$country == "Puerto Rico") & -->
<!-- >                     ((gapminder$year > 1970) & -->
<!-- >                     (gapminder$year < 1980)),] -->
<!-- > median(noAm2$pop) -->
<!-- > ``` -->
<!-- > -->
<!-- > #### Solution to challenge MCQ: Data Reduction {.challenge} -->
<!-- > -->
<!-- > Produce a data.frame with only the names, years, and per-capita GDP of  -->
<!-- > countries where per capita gdp is less than a dollar a day sorted from most-  -->
<!-- > to least-recent. -->
<!-- > -->
<!-- > - Tip: The `gdpPercap` variable is annual gdp. You'll need to adjust. -->
<!-- > - Tip: For complex tasks, it often helps to use pencil and paper to  -->
<!-- > write/draw/map the various steps needed and how they fit together before  -->
<!-- > writing any code. -->
<!-- > -->
<!-- > What is the annual per-capita gdp, rounded to the nearest dollar, of the first  -->
<!-- > row in the data.frame? -->
<!-- > -->
<!-- > a. $278 -->
<!-- > b. $312 -->
<!-- > c. $331 -->
<!-- > d. $339 -->
<!-- >  -->
<!-- > ```{r data reduction A} -->
<!-- > dailyGDP = mutate(gapminder, onedayGDP = gdpPercap / 365) -->
<!-- > dailyGDP = filter(dailyGDP, onedayGDP < 1) -->
<!-- > dailyGDP = select(dailyGDP, country, year, gdpPercap) -->
<!-- > dailyGDP[1,] -->
<!-- > ``` -->
<!-- > -->
<!-- > **Advanced**: Use dplyr functions and ggplot to plot per-capita GDP versus -->
<!-- > population for North American countries after 1970. -->
<!-- > - Once you've made the graph, transform both axes to a log10 scale. There are -->
<!-- > two ways to do this, one by creating new columns in the data frame, and -->
<!-- > another using functions provided by ggplot to transform the axes. Implement -->
<!-- > both, in that order. Which do you prefer and why? -->
<!-- > -->
<!-- > ```{r data reduction B} -->
<!-- > noAm = filter(gapminder, country == "United States" |  -->
<!-- >                 country == "Canada" | country == "Mexico" |  -->
<!-- >                 country == "Puerto Rico" & year > 1970 -->
<!-- >               ) -->
<!-- > ggplot(noAm, aes(x = gdpPercap, y = pop, color = country)) + -->
<!-- >   geom_point() +  -->
<!-- >   scale_x_log10() + -->
<!-- >   scale_y_log10() -->
<!-- > # OR -->
<!-- > noAmlog10 = mutate(noAm, log10pop = log10(pop), -->
<!-- >                    log10gdp = log10(gdpPercap)) -->
<!-- > ggplot(noAmlog10, aes(x = log10gdp, y = log10pop, color = country)) + -->
<!-- >   geom_point() -->
<!-- > ``` -->
<!-- > -->
<!-- > #### Challenge: Data Reduction with Pipes -->
<!-- > -->
<!-- > Copy the code you (or the instructor) wrote to solve the previous MCQ Data  -->
<!-- > Reduction challenge. Rewrite it using pipes (i.e. no assignment and no nested  -->
<!-- > functions) -->
<!-- > -->
<!-- > ```{r data reduction pipes} -->
<!-- > # previous challenge with pipes -->
<!-- > dailyGDP = mutate(gapminder, onedayGDP = gdpPercap / 365) -->
<!-- > dailyGDP = filter(dailyGDP, onedayGDP < 1) -->
<!-- > dailyGDP = select(dailyGDP, country, year, gdpPercap) -->
<!-- > # BECOMES -->
<!-- > smallGDP = gapminder %>% -->
<!-- >   mutate(onedayGDP = gdpPercap / 365) %>% -->
<!-- >   filter(onedayGDP < 1) %>% -->
<!-- >   select(country, year, gdpPercap) -->
<!-- > smallGDP[1,] -->
<!-- > # OR, more fancy (without an intermediate temp variable) -->
<!-- > (gapminder %>% -->
<!-- >   mutate(onedayGDP = gdpPercap / 365) %>% -->
<!-- >   filter(onedayGDP < 1) %>% -->
<!-- >   select(country, year, gdpPercap))[1,] -->
<!-- > ``` -->
<!-- > -->
<!-- > #### Challenge -- Part 1  -->
<!-- > -->
<!-- > - Calculate a new column: the total GDP of each country in each year.  -->
<!-- > - Calculate the variance -- `var()` of countries' gdps in each year. -->
<!-- > - Is country-level GDP getting more or less equal over time? -->
<!-- > - Plot your findings. -->
<!-- >  -->
<!-- > ```{r challenge LessonEnd part1} -->
<!-- > varGDP = gapminder %>% -->
<!-- >   mutate(totalGDP = gdpPercap * pop) %>% -->
<!-- >   group_by(year) %>% -->
<!-- >   summarize(varTotGDP = var(totalGDP)) -->
<!-- > ggplot(varGDP, aes(x = year, y = varTotGDP)) + -->
<!-- >   geom_point() -->
<!-- > ``` -->
<!-- > -->
<!-- > #### Challenge -- Part 2 -->
<!-- > -->
<!-- > - Modify the code you just wrote to calculate the variance in both  -->
<!-- > country-level GDP and per-capita GDP.  -->
<!-- > - Do both measures support the conclusion you arrived at above? -->
<!-- >  -->
<!-- > ```{r challenge LessonEnd part2} -->
<!-- > varGDP = gapminder %>% -->
<!-- >   mutate(totalGDP = gdpPercap * pop) %>% -->
<!-- >   group_by(year) %>% -->
<!-- >   summarize(varTotGDP = var(totalGDP), -->
<!-- >             varPerCapGDP = var(gdpPercap) -->
<!-- >             ) -->
<!-- > ggplot(varGDP) + -->
<!-- >   geom_point(color = "red", aes(x = year, y = varTotGDP)) + -->
<!-- >   geom_point(color = "blue", aes(x = year, y = varPerCapGDP)) -->
<!-- > ``` -->
<!-- > #### Challenge -- Part 3 (Advanced)  -->
<!-- >  -->
<!-- > The above plotting exercise asked you to plot summarized information, but it  -->
<!-- > is generally preferable to avoid summarizing before plotting. Can you generate  -->
<!-- > a plot that shows the information you calculated in Part 1 without  -->
<!-- > summarizing? -->
<!-- > -->
<!-- > - Hint: `ggplot` interprets the `gapminder$year` as a numeric variable, which  -->
<!-- may be okay, but there are some plot types for which you need `ggplot` to see  -->
<!-- `gapminder$year` as a category. You can accomplish this by wrapping it in  -->
<!-- `factor` -- e.g. `ggplot(gapminder, aes(x = factor(year) ...` -->
<!-- > -->
<!-- > -->
<!-- > ```{r challenge LessonEnd part3, fig.width=8} -->
<!-- > gapminder %>% -->
<!-- >   mutate(totalGDP = gdpPercap * pop) %>% -->
<!-- > ggplot(aes(x = factor(year), y = totalGDP)) + -->
<!-- >   geom_violin() + -->
<!-- >   scale_y_log10()  -->
<!-- >  ``` -->
<!-- > -->
<p>This lesson is adapted from the Software Carpentry: R for Reproducible Scientific Analysis <a href="http://data-lessons.github.io/gapminder-R/04-ggplot.html">Creating Publication Quality Graphics materials</a></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>R for reproducible scientific analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    About
  </a>
</li>
<li>
  <a href="syllabus.html">
    <span class="fa fa-map fa-1x"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Set Up!
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="computer_setup.html">Computer Setup</a>
    </li>
    <li>
      <a href="setting_up_git.html">Setting up Git Repository</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book  fa-1x"></span>
     
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_intro_r_rstudio.html">Orientation to Programming, R, &amp; RStudio</a>
    </li>
    <li>
      <a href="lesson_project_management.html">Project Management</a>
    </li>
    <li>
      <a href="http://www.datacarpentry.org/spreadsheet-ecology-lesson/">Spreadsheets</a>
    </li>
    <li>
      <a href="http://www.datacarpentry.org/R-ecology-lesson/01-intro-to-r.html#vectors_and_data_types">Vectors &amp; Data Types</a>
    </li>
    <li>
      <a href="lesson_data_frames_continents.html">Data frames (continents)</a>
    </li>
    <li>
      <a href="lesson_data_frames_ecology.html">Data frames (ecology)</a>
    </li>
    <li>
      <a href="lesson_dplyr_ecology.html">Using dplyr (ecology)</a>
    </li>
    <li>
      <a href="lesson_dplyr_gapminder.html">Using dplyr (gapminder)</a>
    </li>
    <li>
      <a href="lesson_visualization_ggplot2.html">Using ggplot2 (gapminder)</a>
    </li>
    <li>
      <a href="http://www.datacarpentry.org/R-ecology-lesson/04-visualization-ggplot2.html">Using ggplot2 (ecology)</a>
    </li>
    <li>
      <a href="lesson_visualization_dos.html">Visualization Do's &amp; Don'ts</a>
    </li>
    <li>
      <a href="lesson_rmarkdown.html">Literate Programming with RMarkdown</a>
    </li>
    <li>
      <a href="lesson_data_import.html">Data import &amp; export</a>
    </li>
    <li>
      <a href="lesson_tidyr.html">Using tidyr</a>
    </li>
    <li>
      <a href="lesson_joins.html">Joining data</a>
    </li>
    <li>
      <a href="lesson_import_dplyr_ggplot2.html">Pipelines: data import %&gt;% dplyr %&gt;% ggplot2</a>
    </li>
    <li>
      <a href="lesson_ice_core_CO2_web_data.html">Pipelines: Download CO2 &amp; Ice Core Data &amp; Visualize</a>
    </li>
    <li>
      <a href="lesson_lubridate.html">Times &amp; Dates with lubridate</a>
    </li>
    <li>
      <a href="lesson_functions.html">Writing functions</a>
    </li>
    <li>
      <a href="lesson_for_loops.html">For loops</a>
    </li>
    <li>
      <a href="lesson_purrr_tutorial.html">Using purrr</a>
    </li>
    <li>
      <a href="https://ryanpeek.github.io/mapping_in_R/index.html">
        <span class="fa fa-map fa-1.5x"></span>
         
        Mapping in R
      </a>
    </li>
    <li>
      <a href="lesson_text_mining_mlk.html">Text mining</a>
    </li>
    <li>
      <a href="lesson_github_collaboration.html">Github collaboration with branches</a>
    </li>
    <li>
      <a href="http://www.datacarpentry.org/R-ecology-lesson/05-r-and-databases.html">R and SQL</a>
    </li>
  </ul>
</li>
<li>
  <a href="lectures.html">
    <span class="fa fa-slideshare fa-1x"></span>
     
    Lectures
  </a>
</li>
<li>
  <a href="assignments.html">
    <span class="fa fa-paperclip fa-1x"></span>
     
    Assignments
  </a>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-list"></span>
     
    Resources
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://github.com/gge-ucd/R-DAVIS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">R for reproducible scientific analysis</h1>
<h3 class="subtitle"><em>Tidy Data</em></h3>

</div>


<blockquote>
<h2 id="learning-objectives">Learning objectives</h2>
<ul>
<li>Understand what it means for data to be tidy
<ul>
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ul></li>
<li>Be able to use <code>tidyr::gather</code> to make “wide” data “long”</li>
</ul>
</blockquote>
<div id="tidy-data" class="section level3">
<h3>Tidy data</h3>
<p>Data can be organized many ways. While there may be times that call for other organizational schemes, this is the standard and generally-best way to organize data:</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column</li>
<li>Each observation forms a row</li>
<li>Each observational type forms a table</li>
</ol>
<p>What exactly constitutes a variable can be difficult to define out of context, but as a general rule, if observations are measured in different units, they should be in different columns, and if they are measured in the same units, there is a good chance they should be in the same column.</p>
<p>An example will clarify. Download <a href="data/wide_eg.csv">this fake data</a> on blood readings under several medical treatments. Save it to your data directory and read it into R. Is this data in tidy format? Why not – which of the three principles does it not satisfy?</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">blood &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;data/wide_eg.csv&#39;</span>)</a></code></pre></div>
<pre><code>## Warning: Missing column names filled in: &#39;X2&#39; [2], &#39;X3&#39; [3], &#39;X4&#39; [4],
## &#39;X5&#39; [5]</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   `Blood albumin levels in four individuals (g / dL)` = col_character(),
##   X2 = col_character(),
##   X3 = col_character(),
##   X4 = col_character(),
##   X5 = col_character()
## )</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">blood</a></code></pre></div>
<pre><code>## # A tibble: 14 x 5
##    `Blood albumin levels in four individua… X2    X3     X4       X5      
##    &lt;chr&gt;                                    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;   
##  1 &lt;NA&gt;                                     &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;     &lt;NA&gt;    
##  2 subject                                  sex   contr… treatme… treatme…
##  3 1                                        M     4.49   1.61     3.03    
##  4 2                                        F     5.98   3.40     3.79    
##  5 3                                        F     3.77   1.92     4.66    
##  6 4                                        M     2.60   4.72     7.48    
##  7 5                                        m     5.20   1.76     9.77    
##  8 6                                        F     4.22   4.41     7.23    
##  9 7                                        F     2.25   6.55     2.51    
## 10 8                                        F     3.76   1.92     9.60    
## 11 9                                        M     4.93   2.73     7.26    
## 12 10                                       M     5.66   6.10     9.88    
## 13 11                                       F     3.30   3.92     4.47    
## 14 12                                       M     5.90   1.52     2.66</code></pre>
<p>Hmm, that doesn’t look quite right? What do you think happened? How could we fix it? The answer, of course, is in the <code>?read_csv</code> helpfile.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">blood &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;data/wide_eg.csv&#39;</span>, <span class="dt">skip =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   subject = col_integer(),
##   sex = col_character(),
##   control = col_double(),
##   treatment1 = col_double(),
##   treatment2 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">blood</a></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##    subject sex   control treatment1 treatment2
##      &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1       1 M        4.49       1.61       3.03
##  2       2 F        5.98       3.4        3.79
##  3       3 F        3.77       1.92       4.66
##  4       4 M        2.6        4.72       7.48
##  5       5 m        5.2        1.76       9.77
##  6       6 F        4.22       4.41       7.23
##  7       7 F        2.25       6.55       2.51
##  8       8 F        3.76       1.92       9.6 
##  9       9 M        4.93       2.73       7.26
## 10      10 M        5.66       6.1        9.88
## 11      11 F        3.3        3.92       4.47
## 12      12 M        5.9        1.52       2.66</code></pre>
<p>There’s one other little problem in this dataset – do you see it? One of the subject’s sexes was entered as “m” instead of “M”. If we later try to <code>group_by</code> sex or plot by sex, we will get three groups: “F”, “M”, and “m”. To fix this, we could identify the errant entry and replace it specifically with something like <code>blood$sex[blood$sex == &quot;m&quot;] = &quot;M&quot;</code>, or we can simply tell R to make all the entries in that variable upper-case with the <code>toupper</code> function:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">blood<span class="op">$</span>sex</a></code></pre></div>
<pre><code>##  [1] &quot;M&quot; &quot;F&quot; &quot;F&quot; &quot;M&quot; &quot;m&quot; &quot;F&quot; &quot;F&quot; &quot;F&quot; &quot;M&quot; &quot;M&quot; &quot;F&quot; &quot;M&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">toupper</span>(blood<span class="op">$</span>sex)</a></code></pre></div>
<pre><code>##  [1] &quot;M&quot; &quot;F&quot; &quot;F&quot; &quot;M&quot; &quot;M&quot; &quot;F&quot; &quot;F&quot; &quot;F&quot; &quot;M&quot; &quot;M&quot; &quot;F&quot; &quot;M&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">blood<span class="op">$</span>sex =<span class="st"> </span><span class="kw">toupper</span>(blood<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co"># Or, using dplyr:</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">blood =<span class="st"> </span><span class="kw">mutate</span>(blood, <span class="dt">sex =</span> <span class="kw">toupper</span>(sex))</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co"># Note that those accomplish the exact same thing in very different ways. Studying the difference may be useful. </span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">blood</a></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##    subject sex   control treatment1 treatment2
##      &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1       1 M        4.49       1.61       3.03
##  2       2 F        5.98       3.4        3.79
##  3       3 F        3.77       1.92       4.66
##  4       4 M        2.6        4.72       7.48
##  5       5 M        5.2        1.76       9.77
##  6       6 F        4.22       4.41       7.23
##  7       7 F        2.25       6.55       2.51
##  8       8 F        3.76       1.92       9.6 
##  9       9 M        4.93       2.73       7.26
## 10      10 M        5.66       6.1        9.88
## 11      11 F        3.3        3.92       4.47
## 12      12 M        5.9        1.52       2.66</code></pre>
<p>It looks like we’ve got 12 individuals, each subjected to three conditions – a control and two treatments. Each observation here is a person in a treatment (we don’t know what the measured value is), so each row should be defined by a person-treatment; that is, we should have 12 rows with four columns: subject, sex, condition, and the measured value.</p>
<div id="gather" class="section level4">
<h4><code>gather()</code></h4>
<p>A typical analysis of data like these consists of calculating means and standard deviations by condition and sex. It is possible to do this with the data in their current form, but it will be much easier if we tidy the data first.</p>
<p>We can transform the data to tidy form with the <code>gather</code> function from the <code>tidyr</code> package, which of course is part of the <code>tidyverse</code>.</p>
<p>Let’s look at the arguments to <code>gather</code> include the data.frame you’re gathering, which columns to gather, and names for two columns in the new data.frame: the key and the value. The key will consist of the old names of gathered columns, and the value will consist of the entries in those columns. The order of arguments is data.frame, key, value, columns-to-gather:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">gather</span>(blood, <span class="dt">key =</span> condition, <span class="dt">value =</span> albumin,</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">       control, treatment1, treatment2)</a></code></pre></div>
<pre><code>## # A tibble: 36 x 4
##    subject sex   condition albumin
##      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1       1 M     control      4.49
##  2       2 F     control      5.98
##  3       3 F     control      3.77
##  4       4 M     control      2.6 
##  5       5 M     control      5.2 
##  6       6 F     control      4.22
##  7       7 F     control      2.25
##  8       8 F     control      3.76
##  9       9 M     control      4.93
## 10      10 M     control      5.66
## # ... with 26 more rows</code></pre>
<p>You can also tell <code>gather</code> which columns <em>not</em> to gather – these are the “ID variables”; that is, they identify the unit of analysis on each row.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">blood.tidy &lt;-<span class="st"> </span><span class="kw">gather</span>(blood, <span class="dt">key =</span> condition, <span class="dt">value =</span> albumin,</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">                     <span class="op">-</span>subject, <span class="op">-</span>sex)</a></code></pre></div>
<p>Note that the variables with <code>-</code> in front of them aren’t removed from the data.frame. Instead we get one row for each combination of those variables.</p>
</div>
</div>
<div id="packages-in-the-tidyverse-expect-tidy-data" class="section level3">
<h3>Packages in the tidyverse expect tidy data</h3>
<p>Now that the <code>blood</code> data is in tidy form we can easily summarize and plot it using <em>dplyr</em> and <em>ggplot2</em>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">summarize</span>(<span class="kw">group_by</span>(blood.tidy, sex, condition),</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">          <span class="kw">mean</span>(albumin),</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">          <span class="kw">sd</span>(albumin))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   sex [?]
##   sex   condition  `mean(albumin)` `sd(albumin)`
##   &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt;         &lt;dbl&gt;
## 1 F     control               3.88          1.23
## 2 F     treatment1            3.69          1.74
## 3 F     treatment2            5.38          2.58
## 4 M     control               4.80          1.19
## 5 M     treatment1            3.07          1.91
## 6 M     treatment2            6.68          3.17</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">ggplot</span>(blood.tidy, <span class="kw">aes</span>(<span class="dt">x =</span> condition, <span class="dt">y =</span> albumin, <span class="dt">color =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">          </span><span class="kw">geom_violin</span>()</a></code></pre></div>
<p><img src="lesson_tidyr_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<blockquote>
<h4 id="challenge-gather-and-plot">Challenge – Gather and plot</h4>
<p>The following code produces a data.frame with the annual relative standard deviation of gdp among countries, both by per-capita gdp and country-total gdp. Run the code. Is the resulting dataset in tidy form?</p>
<pre><code>gapminder %&gt;%
    mutate(gdpCountry = gdpPercap * pop) %&gt;%
    group_by(year) %&gt;%
    summarize(RSD_individual = sd(gdpPercap) / mean(gdpPercap),
              RSD_country = sd(gdpCountry) / mean(gdpCountry))</code></pre>
<p>You could argue that it is or is not in tidy form, because you could see the two outcomes as different variables or two ways of measuring the same variable. For our purposes, consider them two ways of measuring the same variable and <code>gather</code> the data.frame so that there is only one measurement of RSD on each row.</p>
<p>Make a plot with two lines, one for each measure of RSD in gdp, by year. To make the plot black-and-white-printer friendly, distinguish the lines using the <code>linetype</code> <strong>aes</strong>thetic. Could you have made this plot without tidying the data? Why or why not?</p>
</blockquote>
<blockquote>
<h4 id="challenge-more-practice-with-gather">Challenge – More practice with gather</h4>
<p>Download <a href="data/stocks.tsv">this dataset</a> of closing prices for several restaurant stocks over a year.</p>
<ul>
<li>Is the data tidy?<br />
</li>
<li>If not, tidy it</li>
<li>Which stock performed the best over this year? Use any method you want to answer that question.</li>
</ul>
</blockquote>
<p><br></p>
<p>This lesson is adapted from the Software Carpentry: R for Reproducible Scientific Analysis <a href="http://data-lessons.github.io/gapminder-R/06-tidy-data.html">Tidy Data materials</a>.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Dates &amp; Times in R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    About
  </a>
</li>
<li>
  <a href="syllabus.html">
    <span class="fa fa-map fa-1x"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Set Up!
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="computer_setup.html">Computer Setup</a>
    </li>
    <li>
      <a href="setting_up_git.html">Setting up Git Repository</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book  fa-1x"></span>
     
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_intro_r_rstudio.html">Orientation to Programming, R, &amp; RStudio</a>
    </li>
    <li>
      <a href="lesson_project_management.html">Project Management</a>
    </li>
    <li>
      <a href="lesson_spreadsheets_condensed.html">Spreadsheets</a>
    </li>
    <li>
      <a href="lesson_vectors.html">Vectors &amp; Data Types</a>
    </li>
    <li>
      <a href="lesson_data_frames_ecology.html">Data Frames</a>
    </li>
    <li>
      <a href="lesson_dplyr_ecology.html">Using dplyr</a>
    </li>
    <li>
      <a href="lesson_ggplot_ecology.html">Using ggplot2</a>
    </li>
    <li>
      <a href="lesson_data_import.html">Data Import &amp; Export</a>
    </li>
    <li>
      <a href="lesson_visualization_dos.html">Visualization Do's &amp; Don'ts</a>
    </li>
    <li>
      <a href="lesson_rmarkdown.html">Literate Programming with RMarkdown</a>
    </li>
    <li>
      <a href="lesson_tidyr.html">Using tidyr</a>
    </li>
    <li>
      <a href="lesson_lubridate.html">Times &amp; Dates with lubridate</a>
    </li>
    <li>
      <a href="lesson_functions.html">Writing functions</a>
    </li>
    <li>
      <a href="lesson_iteration.html">Iteration</a>
    </li>
  </ul>
</li>
<li>
  <a href="lectures.html">
    <span class="fa fa-slideshare fa-1x"></span>
     
    Lectures
  </a>
</li>
<li>
  <a href="assignments.html">
    <span class="fa fa-paperclip fa-1x"></span>
     
    Assignments
  </a>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-list"></span>
     
    Resources
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://github.com/gge-ucd/R-DAVIS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Dates &amp; Times in R</h1>
<h3 class="subtitle"><em>Working with datetimes and <code>lubridate</code></em></h3>

</div>


<p><br></p>
<div id="learning-objectives" class="section level2">
<h2>Learning objectives</h2>
<blockquote>
<ul>
<li>Learn the basic date/datetime data types in R</li>
<li>Gain familiarity with converting dates &amp; timezones</li>
<li>Learn how to use the <code>lubridate</code> package to more easily work with these data.</li>
<li>A few tricks about management of datetime data</li>
</ul>
</blockquote>
</div>
<div id="background-reading" class="section level2">
<h2>Background Reading</h2>
<p>These resources are very useful. Please read through them.</p>
<ul>
<li><p>This is a great overview of times and dates in R from <a href="http://www.noamross.net/blog/2014/2/10/using-times-and-dates-in-r---presentation-code.html">Bonnie Dixon’s talk at the Davis R-Users Group</a></p></li>
<li><p><a href="https://www.stat.berkeley.edu/~s133/dates.html">A very comprehensive and detailed look at using dates in R</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html">The vignette on using lubridate</a></p></li>
</ul>
</div>
<div id="date-time-classes-in-r" class="section level1">
<h1>Date-Time Classes in R</h1>
<p>Importantly, there are <strong>3</strong> basic time classes in R:</p>
<ul>
<li><strong><code>Dates</code></strong> (just dates, i.e., 2012-02-10)</li>
<li><strong><code>POSIXct</code></strong> (“<strong>ct</strong>” == calendar time, best class for dates with times)</li>
<li><strong><code>POSIXlt</code></strong> (“<strong>lt</strong>” == local time, enables easy extraction of specific components of a time, however, remember that POXIXlt objects are lists)</li>
</ul>
<p>So, for some brief examples/discussion about each of these classes, please read below. Unfortunately converting dates &amp; times in R into formats that are computer readable can be frustrating, mainly because there is very little consistency. In particular, if you are importing things from Excel, keep in mind dates can get especially weird<sup>1</sup>, depending on the operating system you are working on, the format of your data, etc.</p>
<p><sup><em>1</em></sup> <sub><em>For example Excel stores dates as a number representing days since 1900-Jan-0, plus a fractional portion of a 24 hour day (<strong>serial-time</strong>), but in OSX (Mac), it is 1904-Jan-0.</em></sub></p>
<div id="dates" class="section level2">
<h2>Dates</h2>
<p>The <code>Date</code> class in R can easily be converted or operated on numerically, depending on the interest. Let’s make a string of dates to use for our example:</p>
<ul>
<li><code>sample_dates_1 &lt;- c(&quot;2016-02-01&quot;, &quot;2016-03-21&quot;, &quot;2016-10-05&quot;, &quot;2017-01-01&quot;, &quot;2017-02-18&quot;)</code> <em>notice we have dates across two years here</em></li>
</ul>
<p>So to translate these into the <code>Date</code> class in R, we need to do a few things…first notice our sample dates are in a very nice order (YYYY-MM-DD). This works well with the function <code>as.Date</code>:</p>
<ul>
<li><code>as.Date(sample_dates_1)</code></li>
</ul>
<p>What happens with different orders…say MM-DD-YYYY?</p>
<pre class="r"><code># Some sample dates: 
sample_dates_2 &lt;- c(&quot;02-01-2016&quot;, &quot;03-21-2016&quot;, &quot;10-05-2016&quot;, &quot;01-01-2017&quot;, &quot;02-18-2017&quot;)

as.Date(sample_dates_2) # well that doesn&#39;t work</code></pre>
<pre><code>## [1] &quot;0002-01-20&quot; NA           &quot;0010-05-20&quot; &quot;0001-01-20&quot; NA</code></pre>
<p>Well, the reason is the computer expects one thing, but is getting something else. Remember, <strong>write code you can read and your computer can understand</strong>. So we need to give some more information here so R will interpret our data correctly.</p>
<pre class="r"><code># Some sample dates: 
sample_dates_2 &lt;- c(&quot;02-01-2016&quot;, &quot;03-21-2016&quot;, &quot;10-05-2016&quot;, &quot;01-01-2017&quot;, &quot;02-18-2017&quot;)

as.Date(sample_dates_2, format = &quot;%m-%d-%Y&quot; ) # date code preceded by &quot;%&quot;</code></pre>
<pre><code>## [1] &quot;2016-02-01&quot; &quot;2016-03-21&quot; &quot;2016-10-05&quot; &quot;2017-01-01&quot; &quot;2017-02-18&quot;</code></pre>
<p>To see a list of the date-time format codes in R, check out this <a href="https://www.stat.berkeley.edu/~s133/dates.html">page and table</a>, or you can use: <code>?(strptime)</code></p>
<p>The nice thing is this method works well with pretty much any format, you just need to provide the associated codes and structure:</p>
<ul>
<li><p><code>as.Date(&quot;2016/01/01&quot;, format=&quot;%Y/%m/%d&quot;)</code>=2016-01-01</p></li>
<li><p><code>as.Date(&quot;05A21A2011&quot;, format=&quot;%mA%dA%Y&quot;)</code>=2011-05-21</p></li>
</ul>
<blockquote>
<h3 id="challenge">Challenge:</h3>
<p>Format this date with the <code>as.Date</code> function: <code>Jul 04, 2017</code></p>
</blockquote>
<div id="date-calculations" class="section level3">
<h3>Date Calculations</h3>
<p>It’s possible to use dates in calculations as well, as long as they are formatted in the same data type (i.e., both are <code>date</code> in this case).</p>
<p><strong>Make some fake dates</strong></p>
<pre class="r"><code># format a value as `date`
dt1 &lt;- as.Date(&quot;2017-07-11&quot;)
dt1</code></pre>
<pre><code>## [1] &quot;2017-07-11&quot;</code></pre>
<pre class="r"><code># non-standard formats must be specified using format=
dt2 &lt;- as.Date(&quot;04/22/2016&quot;, format = &quot;%m/%d/%Y&quot;)
dt2</code></pre>
<pre><code>## [1] &quot;2016-04-22&quot;</code></pre>
<pre class="r"><code>dt3 &lt;- as.Date(&quot;October 6, 2014&quot;, format = &quot;%B %d, %Y&quot;)
dt3</code></pre>
<pre><code>## [1] &quot;2014-10-06&quot;</code></pre>
<p><strong>Now some calculations</strong></p>
<pre class="r"><code># subtract differences in dates
print(dt1 - dt2)</code></pre>
<pre><code>## Time difference of 445 days</code></pre>
<pre class="r"><code># or look at differences in alternate scales
print(difftime(dt1, dt2, units = &quot;weeks&quot;))</code></pre>
<pre><code>## Time difference of 63.57143 weeks</code></pre>
<p>You can also sequence along by a given interval to create a timeseries.</p>
<pre class="r"><code>six.weeks &lt;- seq(dt1, length = 6, by = &quot;week&quot;)
six.weeks</code></pre>
<pre><code>## [1] &quot;2017-07-11&quot; &quot;2017-07-18&quot; &quot;2017-07-25&quot; &quot;2017-08-01&quot; &quot;2017-08-08&quot;
## [6] &quot;2017-08-15&quot;</code></pre>
<blockquote>
<h3 id="challenge-1">Challenge:</h3>
<p>Create a sequence of 10 dates with a 2 week interval starting on 2011-02-15</p>
</blockquote>
</div>
</div>
<div id="the-lubridate-package-with-dates" class="section level2">
<h2>The <code>lubridate</code> package with Dates</h2>
<p>The <code>lubridate</code> package will handle 90% of the date &amp; datetime issues you need to deal with. It is fast, much easier to work with, and I recommend using it wherever possible. Do keep in mind sometimes you need to fall back on the base R functions (i.e., <code>as.Date()</code>).</p>
<p><code>library(lubridate)</code></p>
<p>Same idea here, just simpler to type, read, write.</p>
<ul>
<li><code>lubridate::ymd(&quot;2016/01/01&quot;)</code>=2016-01-01</li>
<li><code>lubridate::ymd(&quot;2011-03-19&quot;)</code>=2011-03-19</li>
<li><code>lubridate::mdy(&quot;Feb 19, 2011&quot;)</code>=2011-02-19</li>
<li><code>lubridate::dmy(&quot;22051997&quot;)</code>=1997-05-22</li>
</ul>
</div>
<div id="using-posixct" class="section level2">
<h2>Using <strong><code>POSIXct</code></strong></h2>
<p>When working with times, the best class to use (generally) is <code>POSIXct</code>.</p>
<p>Making some POSXct objects:</p>
<pre class="r"><code>tm1 &lt;- as.POSIXct(&quot;2016-07-24 23:55:26&quot;)
tm1</code></pre>
<pre><code>## [1] &quot;2016-07-24 23:55:26 CDT&quot;</code></pre>
<pre class="r"><code>tm2 &lt;- as.POSIXct(&quot;25072016 08:32:07&quot;, format = &quot;%d%m%Y %H:%M:%S&quot;)
tm2</code></pre>
<pre><code>## [1] &quot;2016-07-25 08:32:07 CDT&quot;</code></pre>
<pre class="r"><code># specify the time zone:
tm3 &lt;- as.POSIXct(&quot;2010-12-01 11:42:03&quot;, tz = &quot;GMT&quot;)
tm3</code></pre>
<pre><code>## [1] &quot;2010-12-01 11:42:03 GMT&quot;</code></pre>
</div>
<div id="working-with-timezones-datetimes" class="section level2">
<h2>Working with Timezones &amp; Datetimes</h2>
<p>Similar to <code>as.Date</code> there are two functions for each datetime class in R. <code>as.POSIXct</code> and <code>as.POSIXlt</code>. The arguments are the largely the same, but two important components to consider are a <code>strptime</code> function to help format the datetime (similar to <code>as.Date</code>), and a timezone argument <code>tz</code>, for adding the appropriate timezone.</p>
<p>Keep in mind the default datetime format is <code>YMD HM</code> or <code>YMD HMS</code>, so if you use that format you won’t need to use the <code>strptime</code> option.</p>
<div id="as.posixct" class="section level3">
<h3><strong>as.POSIXct</strong></h3>
<ul>
<li>Example 1 (default doesn’t need <code>strptime</code>): <code>as.POSIXct(&quot;2016-01-01 12:00&quot;, &quot;America/Los_Angeles&quot;)</code> = 2016-01-01 12:00:00</li>
<li>Example 2 (24 hr time): <code>as.POSIXct(strptime(&quot;2016/04/05 14:47&quot;,format = &quot;%Y/%m/%d %H:%M&quot;), &quot;America/Los_Angeles&quot;)</code> = 2016-04-05 14:47:00</li>
<li>Example 3 (12 hr time): <code>as.POSIXct(strptime(&quot;2016/04/05 4:47 PM&quot;,format = &quot;%Y/%m/%d %H:%M PM&quot;), &quot;America/Los_Angeles&quot;)</code> = 2016-04-05 04:47:00</li>
</ul>
</div>
</div>
<div id="the-lubridate-package-timezones" class="section level2">
<h2>The <code>lubridate</code> package &amp; timezones</h2>
<p>Same as before, now just add <code>_hms</code> or <code>_hm</code> to <code>ymd</code> and a <code>tz</code> arguement. <code>lubridate</code> will default to the POSIXct format.</p>
<ul>
<li>Example 1: <code>lubridate::ymd_hm(&quot;2016-01-01 12:00&quot;, tz=&quot;America/Los_Angeles&quot;)</code> = 2016-01-01 12:00:00</li>
<li>Example 2 (24 hr time): <code>lubridate::ymd_hm(&quot;2016/04/05 14:47&quot;, tz=&quot;America/Los_Angeles&quot;)</code> = 2016-04-05 14:47:00</li>
<li>Example 3 (12 hr time but converts to 24): <code>lubridate::ymd_hms(&quot;2016/04/05 4:47:21 PM&quot;, tz=&quot;America/Los_Angeles&quot;)</code> = 2016-04-05 16:47:21</li>
</ul>
</div>
<div id="datetimes-without-timezones-and-chron" class="section level2">
<h2>Datetimes without Timezones (and <code>chron</code>)</h2>
<p>The <code>chron</code> package may be helpful for these tasks, however, this may also be a suitable use of the POSIXlt class.</p>
<ul>
<li><code>chron::as.chron(&quot;2013-07-24 23:55:26&quot;)</code> = 1.591099710^{4}</li>
<li><code>chron::as.chron(&quot;07/25/13 08:32:07&quot;, &quot;%m/%d/%y %H:%M:%S&quot;)</code> = 1.591135610^{4}</li>
</ul>
<div id="lubridate-tips" class="section level4">
<h4>Lubridate Tips</h4>
<p>For lubridate to work, you need the column datatype to be <strong>character</strong> or <strong>factor</strong>. The <code>readr</code> package (from the <code>tidyverse</code>) is smart and will try to guess for you. Problem is, it might convert your data for you without the settings (in this case the proper timezone). So here are few ways to work around this.</p>
<pre class="r"><code>library(lubridate)
library(dplyr)
library(readr)

# read in some data and skip header lines
nfy1 &lt;- read_csv(&quot;data/2015_NFY_solinst.csv&quot;, skip = 12)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   Date = col_date(format = &quot;&quot;),
##   Time = col_time(format = &quot;&quot;),
##   ms = col_double(),
##   Level = col_double(),
##   Temperature = col_double()
## )</code></pre>
<pre class="r"><code>head(nfy1)</code></pre>
<pre><code>## # A tibble: 6 x 5
##   Date       Time      ms Level Temperature
##   &lt;date&gt;     &lt;time&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
## 1 2015-05-22 14:00      0 -8.68           0
## 2 2015-05-22 14:15      0 -8.29           0
## 3 2015-05-22 14:30      0 -8.29           0
## 4 2015-05-22 14:45      0 -8.29           0
## 5 2015-05-22 15:00      0 -8.30           0
## 6 2015-05-22 15:15      0 -8.29           0</code></pre>
<pre class="r"><code># import raw dataset &amp; specify column types
nfy2 &lt;- read_csv(&quot;data/2015_NFY_solinst.csv&quot;, col_types = &quot;ccidd&quot;, skip=12)

# or just import with read.csv (defaults to factors for the dates)
nfy3 &lt;- read.csv(&quot;data/2015_NFY_solinst.csv&quot;, skip = 12)

glimpse(nfy1) # notice the data types in the Date.Time and datetime cols</code></pre>
<pre><code>## Observations: 7,764
## Variables: 5
## $ Date        &lt;date&gt; 2015-05-22, 2015-05-22, 2015-05-22, 2015-05-22, 2...
## $ Time        &lt;time&gt; 14:00:00, 14:15:00, 14:30:00, 14:45:00, 15:00:00,...
## $ ms          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ Level       &lt;dbl&gt; -8.6834, -8.2928, -8.2914, -8.2901, -8.2955, -8.29...
## $ Temperature &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</code></pre>
<pre class="r"><code>glimpse(nfy2)</code></pre>
<pre><code>## Observations: 7,764
## Variables: 5
## $ Date        &lt;chr&gt; &quot;2015/05/22&quot;, &quot;2015/05/22&quot;, &quot;2015/05/22&quot;, &quot;2015/05...
## $ Time        &lt;chr&gt; &quot;14:00:00&quot;, &quot;14:15:00&quot;, &quot;14:30:00&quot;, &quot;14:45:00&quot;, &quot;1...
## $ ms          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ Level       &lt;dbl&gt; -8.6834, -8.2928, -8.2914, -8.2901, -8.2955, -8.29...
## $ Temperature &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</code></pre>
<pre class="r"><code>glimpse(nfy3)</code></pre>
<pre><code>## Observations: 7,764
## Variables: 5
## $ Date        &lt;fct&gt; 2015/05/22, 2015/05/22, 2015/05/22, 2015/05/22, 20...
## $ Time        &lt;fct&gt; 14:00:00, 14:15:00, 14:30:00, 14:45:00, 15:00:00, ...
## $ ms          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ Level       &lt;dbl&gt; -8.6834, -8.2928, -8.2914, -8.2901, -8.2955, -8.29...
## $ Temperature &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</code></pre>
<pre class="r"><code># make a datetime col:
nfy2$datetime &lt;- paste(nfy2$Date, &quot; &quot;, nfy2$Time, sep = &quot;&quot;)

# convert Date Time to POSIXct in local timezone using lubridate
nfy2$datetime_test &lt;- as_datetime(nfy2$datetime, 
                                    tz=&quot;America/Los_Angeles&quot;)
# convert using the ymd_functions
nfy2$datetime_test2 &lt;- ymd_hms(nfy2$datetime, tz=&quot;America/Los_Angeles&quot;)

# or wrap in as.character()
nfy1$datetime &lt;- ymd_hms(as.character(paste0(nfy1$Date,&quot; &quot;, nfy1$Time)), tz=&quot;America/Los_Angeles&quot;)
tz(nfy1$datetime)</code></pre>
<pre><code>## [1] &quot;America/Los_Angeles&quot;</code></pre>
</div>
</div>
<div id="example-1-mauna-loa-meterological-data" class="section level2">
<h2>Example 1: Mauna Loa Meterological Data</h2>
<p>So, now that we have a decent idea how to format these things, let’s look at some real data, try to format and plot. Let’s use the Mauna Loa meterological data, collected every minute for the year 2001. <em>This dataset has 459,769 observations for 9 different metrics of wind, humidity, barometric pressure, air temperature, and precipitation.</em> Download this dataset <a href="data/mauna_loa_met_2001_minute.rda">here</a>. Save it to your <code>data/</code> folder. Alternatively, you can find it on the R-DAVIS website in the <a href="https://gge-ucd.github.io/R-DAVIS/resources.html">Resources-&gt;Datasets</a> tab.</p>
<pre class="r"><code># let&#39;s load our climate data from our previous lesson:

# what&#39;s different between RDS files and RDA (or Rdata) files?
# rds
mloa &lt;- readRDS(&quot;data/mauna_loa_met_2001_minute.rds&quot;)

# rda
load(&quot;data/mauna_loa_met_2001_minute.rda&quot;)

library(lubridate, warn.conflicts = F)
library(dplyr, warn.conflicts = F)

summary(mloa_2001)</code></pre>
<pre><code>##    filename         siteID            year          month       
##  Length:459769      MLO:459769   Min.   :2001   Min.   : 1.000  
##  Class :character                1st Qu.:2001   1st Qu.: 3.000  
##  Mode  :character                Median :2001   Median : 6.000  
##                                  Mean   :2001   Mean   : 6.474  
##                                  3rd Qu.:2001   3rd Qu.:10.000  
##                                  Max.   :2001   Max.   :12.000  
##       day            hour24           min           windDir      
##  Min.   : 1.00   Min.   : 0.00   Min.   : 0.00   Min.   :-999.0  
##  1st Qu.: 8.00   1st Qu.: 5.00   1st Qu.:15.00   1st Qu.: 115.0  
##  Median :15.00   Median :11.00   Median :30.00   Median : 156.0  
##  Mean   :15.44   Mean   :11.43   Mean   :29.51   Mean   : 144.5  
##  3rd Qu.:22.00   3rd Qu.:18.00   3rd Qu.:45.00   3rd Qu.: 236.0  
##  Max.   :31.00   Max.   :23.00   Max.   :59.00   Max.   : 360.0  
##  windSpeed_m_s       windSteady    baro_hPa        temp_C_2m       
##  Min.   :-99.900   Min.   :-9   Min.   :-999.9   Min.   :-999.900  
##  1st Qu.:  1.900   1st Qu.:-9   1st Qu.:-999.9   1st Qu.:   4.400  
##  Median :  3.500   Median :-9   Median :-999.9   Median :   6.900  
##  Mean   :  1.229   Mean   :-9   Mean   :-999.9   Mean   :   4.747  
##  3rd Qu.:  5.900   3rd Qu.:-9   3rd Qu.:-999.9   3rd Qu.:   9.400  
##  Max.   : 20.500   Max.   :-9   Max.   :-999.9   Max.   :  18.900  
##    temp_C_10m      temp_C_towertop      rel_humid      precip_intens_mm_hr
##  Min.   :-999.90   Min.   :-999.900   Min.   :-99.00   Min.   :-99.0000   
##  1st Qu.:   4.90   1st Qu.:   5.600   1st Qu.: 14.00   1st Qu.:  0.0000   
##  Median :   6.90   Median :   7.200   Median : 28.00   Median :  0.0000   
##  Mean   : -46.69   Mean   :   1.539   Mean   : 31.82   Mean   : -0.8066   
##  3rd Qu.:   8.60   3rd Qu.:   8.800   3rd Qu.: 57.00   3rd Qu.:  0.0000   
##  Max.   :  16.90   Max.   :  16.200   Max.   :138.00   Max.   : 60.0000</code></pre>
<pre class="r"><code>names(mloa_2001)</code></pre>
<pre><code>##  [1] &quot;filename&quot;            &quot;siteID&quot;              &quot;year&quot;               
##  [4] &quot;month&quot;               &quot;day&quot;                 &quot;hour24&quot;             
##  [7] &quot;min&quot;                 &quot;windDir&quot;             &quot;windSpeed_m_s&quot;      
## [10] &quot;windSteady&quot;          &quot;baro_hPa&quot;            &quot;temp_C_2m&quot;          
## [13] &quot;temp_C_10m&quot;          &quot;temp_C_towertop&quot;     &quot;rel_humid&quot;          
## [16] &quot;precip_intens_mm_hr&quot;</code></pre>
<p>One of the important components to consider is each of the datetime columns has been separated…so how do we get them into one column so we can format it as a datetime? The answer is the <code>paste</code> function.</p>
<ul>
<li><code>paste()</code> allows pasting text or vectors (&amp; columns) by a given separator that you specify</li>
<li><code>paste0()</code> is the same thing, but defaults to using a <strong><code>,</code></strong> as the separator.</li>
</ul>
<pre class="r"><code># we need to make a datetime column...let&#39;s use paste
mloa_2001$datetime &lt;- paste0(mloa_2001$year,&quot;-&quot;, mloa_2001$month, &quot;-&quot;, mloa_2001$day,&quot; &quot;, mloa_2001$hour24, &quot;:&quot;, mloa_2001$min) # this makes a character column

head(mloa_2001$datetime) # character vector but not POSIXct yet</code></pre>
<pre><code>## [1] &quot;2001-1-1 0:0&quot; &quot;2001-1-1 0:1&quot; &quot;2001-1-1 0:2&quot; &quot;2001-1-1 0:3&quot;
## [5] &quot;2001-1-1 0:4&quot; &quot;2001-1-1 0:5&quot;</code></pre>
<pre class="r"><code># we can nest this within a lubridate function to convert directly to POSIXct
mloa_2001$datetime &lt;- ymd_hm(mloa_2001$datetime, tz=&quot;Pacific/Honolulu&quot;)

# all in one step
mloa_2001$datetime &lt;- ymd_hm(paste0(mloa_2001$year,&quot;-&quot;, mloa_2001$month, &quot;-&quot;, mloa_2001$day,&quot; &quot;, mloa_2001$hour24, &quot;:&quot;, mloa_2001$min), tz = &quot;Pacific/Honolulu&quot;)

summary(mloa_2001) # notice a new column called &quot;datetime&quot;</code></pre>
<pre><code>##    filename         siteID            year          month       
##  Length:459769      MLO:459769   Min.   :2001   Min.   : 1.000  
##  Class :character                1st Qu.:2001   1st Qu.: 3.000  
##  Mode  :character                Median :2001   Median : 6.000  
##                                  Mean   :2001   Mean   : 6.474  
##                                  3rd Qu.:2001   3rd Qu.:10.000  
##                                  Max.   :2001   Max.   :12.000  
##       day            hour24           min           windDir      
##  Min.   : 1.00   Min.   : 0.00   Min.   : 0.00   Min.   :-999.0  
##  1st Qu.: 8.00   1st Qu.: 5.00   1st Qu.:15.00   1st Qu.: 115.0  
##  Median :15.00   Median :11.00   Median :30.00   Median : 156.0  
##  Mean   :15.44   Mean   :11.43   Mean   :29.51   Mean   : 144.5  
##  3rd Qu.:22.00   3rd Qu.:18.00   3rd Qu.:45.00   3rd Qu.: 236.0  
##  Max.   :31.00   Max.   :23.00   Max.   :59.00   Max.   : 360.0  
##  windSpeed_m_s       windSteady    baro_hPa        temp_C_2m       
##  Min.   :-99.900   Min.   :-9   Min.   :-999.9   Min.   :-999.900  
##  1st Qu.:  1.900   1st Qu.:-9   1st Qu.:-999.9   1st Qu.:   4.400  
##  Median :  3.500   Median :-9   Median :-999.9   Median :   6.900  
##  Mean   :  1.229   Mean   :-9   Mean   :-999.9   Mean   :   4.747  
##  3rd Qu.:  5.900   3rd Qu.:-9   3rd Qu.:-999.9   3rd Qu.:   9.400  
##  Max.   : 20.500   Max.   :-9   Max.   :-999.9   Max.   :  18.900  
##    temp_C_10m      temp_C_towertop      rel_humid      precip_intens_mm_hr
##  Min.   :-999.90   Min.   :-999.900   Min.   :-99.00   Min.   :-99.0000   
##  1st Qu.:   4.90   1st Qu.:   5.600   1st Qu.: 14.00   1st Qu.:  0.0000   
##  Median :   6.90   Median :   7.200   Median : 28.00   Median :  0.0000   
##  Mean   : -46.69   Mean   :   1.539   Mean   : 31.82   Mean   : -0.8066   
##  3rd Qu.:   8.60   3rd Qu.:   8.800   3rd Qu.: 57.00   3rd Qu.:  0.0000   
##  Max.   :  16.90   Max.   :  16.200   Max.   :138.00   Max.   : 60.0000   
##     datetime                  
##  Min.   :2001-01-01 00:00:00  
##  1st Qu.:2001-03-29 06:57:00  
##  Median :2001-06-24 06:13:00  
##  Mean   :2001-06-30 15:28:42  
##  3rd Qu.:2001-10-07 00:34:00  
##  Max.   :2001-12-31 23:59:00</code></pre>
<pre class="r"><code>head(mloa_2001$datetime) # in POSIXct</code></pre>
<pre><code>## [1] &quot;2001-01-01 00:00:00 HST&quot; &quot;2001-01-01 00:01:00 HST&quot;
## [3] &quot;2001-01-01 00:02:00 HST&quot; &quot;2001-01-01 00:03:00 HST&quot;
## [5] &quot;2001-01-01 00:04:00 HST&quot; &quot;2001-01-01 00:05:00 HST&quot;</code></pre>
<blockquote>
<h3 id="challenge-with-dplyr-ggplot">Challenge with <code>dplyr</code> &amp; <code>ggplot</code></h3>
<ul>
<li>Remove the NA’s (-99 and -999) in <code>rel_humid</code>, <code>temp_C_2m</code>, <code>windSpeed_m_s</code></li>
<li>Use <code>dplyr</code> to calculate the mean monthly temperature (<code>temp_C_2m</code>) using the <code>datetime</code> column (<em>HINT: look at <code>lubridate</code> functions like <code>month()</code></em>)</li>
<li>Make a ggplot of the avg monthly temperature</li>
<li>Make a ggplot of the daily average temperature for July (<em>HINT: try <code>yday()</code> function with some <code>summarize()</code> in <code>dplyr</code></em>)</li>
</ul>
</blockquote>
<p><strong>Solutions</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">mon</th>
<th align="right">avg_temp_2m</th>
<th align="right">avg_temp_10m</th>
<th align="right">avg_temp_tower</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Jan</td>
<td align="right">6.29</td>
<td align="right">6.72</td>
<td align="right">7.23</td>
</tr>
<tr class="even">
<td align="left">Feb</td>
<td align="right">4.18</td>
<td align="right">4.48</td>
<td align="right">4.74</td>
</tr>
<tr class="odd">
<td align="left">Mar</td>
<td align="right">4.87</td>
<td align="right">5.06</td>
<td align="right">5.34</td>
</tr>
<tr class="even">
<td align="left">Apr</td>
<td align="right">5.70</td>
<td align="right">5.72</td>
<td align="right">5.89</td>
</tr>
<tr class="odd">
<td align="left">May</td>
<td align="right">6.95</td>
<td align="right">7.07</td>
<td align="right">7.13</td>
</tr>
<tr class="even">
<td align="left">Jun</td>
<td align="right">7.51</td>
<td align="right">7.40</td>
<td align="right">7.46</td>
</tr>
<tr class="odd">
<td align="left">Jul</td>
<td align="right">9.56</td>
<td align="right">8.96</td>
<td align="right">8.84</td>
</tr>
<tr class="even">
<td align="left">Aug</td>
<td align="right">9.36</td>
<td align="right">8.85</td>
<td align="right">8.81</td>
</tr>
<tr class="odd">
<td align="left">Sep</td>
<td align="right">8.43</td>
<td align="right">8.27</td>
<td align="right">8.38</td>
</tr>
<tr class="even">
<td align="left">Oct</td>
<td align="right">7.79</td>
<td align="right">7.60</td>
<td align="right">7.81</td>
</tr>
<tr class="odd">
<td align="left">Nov</td>
<td align="right">8.19</td>
<td align="right">8.40</td>
<td align="right">8.71</td>
</tr>
<tr class="even">
<td align="left">Dec</td>
<td align="right">7.77</td>
<td align="right">7.74</td>
<td align="right">8.17</td>
</tr>
</tbody>
</table>
<p><img src="lesson_lubridate_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><img src="lesson_lubridate_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre><code>## 
## Attaching package: &#39;magrittr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     extract</code></pre>
<pre><code>## Observations: 23
## Variables: 4
## $ day            &lt;int&gt; 1, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 17, 18, ...
## $ avg_temp_2m    &lt;dbl&gt; 7.129730, 13.271782, 11.039383, 10.856874, 11.5...
## $ avg_temp_10m   &lt;dbl&gt; 6.594595, 11.164356, 11.024387, 10.486253, 11.0...
## $ avg_temp_tower &lt;dbl&gt; 6.364865, 9.789604, 10.967694, 10.474180, 10.96...</code></pre>
<p><img src="lesson_lubridate_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre><code>## Observations: 24
## Variables: 4
## $ `hour(datetime)` &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,...
## $ avg_temp_2m      &lt;dbl&gt; 12.279380, 12.021068, 11.643950, 11.213201, 1...
## $ avg_temp_10m     &lt;dbl&gt; 10.071898, 10.001907, 9.858428, 9.821122, 9.7...
## $ avg_temp_tower   &lt;dbl&gt; 9.136405, 9.162726, 9.165874, 9.267327, 9.327...</code></pre>
<p><img src="lesson_lubridate_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="example-2-pressure-transducer-solinst-data-logger" class="section level2">
<h2>Example 2: Pressure Transducer (Solinst) Data Logger</h2>
<p>Let’s practice with another data file, a logger that records water temperature and river stage every 15 minutes from the NF American River. You can download the file by right clicking on the <a href="data/2015_NFA_solinst_08_05.csv">webpage</a>, or simply use the web URL. We’ve practiced both now. (The file is also available on the R-DAVIS website in the <a href="https://gge-ucd.github.io/R-DAVIS/resources.html">Resources-&gt;Datasets</a> tab.)</p>
<p><em>This dataset has 35,038 observations for water temperature, and stage (pressure transducer info).</em></p>
<blockquote>
<p>First part of the challenge: Read in and assign the data to your environment using either the direct webpage URL, or the downloaded file.</p>
</blockquote>
<pre><code>##          Date             Time             ms        Level       
##  2014/08/06:   96   00:00:00:  365   Min.   :0   Min.   :0.7718  
##  2014/08/07:   96   00:15:00:  365   1st Qu.:0   1st Qu.:1.1190  
##  2014/08/08:   96   00:30:00:  365   Median :0   Median :1.3135  
##  2014/08/09:   96   00:45:00:  365   Mean   :0   Mean   :1.3791  
##  2014/08/10:   96   01:00:00:  365   3rd Qu.:0   3rd Qu.:1.5235  
##  2014/08/11:   96   01:15:00:  365   Max.   :0   Max.   :4.7376  
##  (Other)   :34462   (Other) :32848                               
##   Temperature    
##  Min.   : 1.724  
##  1st Qu.: 8.197  
##  Median :13.258  
##  Mean   :14.291  
##  3rd Qu.:20.960  
##  Max.   :28.748  
## </code></pre>
<pre><code>## [1] &quot;Date&quot;        &quot;Time&quot;        &quot;ms&quot;          &quot;Level&quot;       &quot;Temperature&quot;</code></pre>
<blockquote>
<h3 id="challenge-2">Challenge</h3>
<ul>
<li>Make a <code>datetime</code> column and format as <code>POSIXct</code></li>
<li>Calculate Weekly <strong>Mean, Max, Min</strong> Water Temperatures and plot as point or line plot <em>(HINT: <code>dplyr</code> function)</em></li>
<li>Calculate Hourly mean <strong>Level</strong> for April through June and make a line plot (using <code>ggplot2</code>).</li>
<li>Make a ggplot geom_pointrange plot of the avg. max, min monthly temperatures.</li>
</ul>
</blockquote>
<p><strong>Solutions</strong></p>
<pre><code>##         Date     Time ms  Level Temperature            datetime   yr mon
## 1 2014/08/05 11:00:00  0 0.8245      23.069 2014-08-05 11:00:00 2014   8
## 2 2014/08/05 11:15:00  0 1.1457      22.023 2014-08-05 11:15:00 2014   8
## 3 2014/08/05 11:30:00  0 1.1485      22.030 2014-08-05 11:30:00 2014   8
## 4 2014/08/05 11:45:00  0 1.1482      22.035 2014-08-05 11:45:00 2014   8
## 5 2014/08/05 12:00:00  0 1.1504      22.033 2014-08-05 12:00:00 2014   8
## 6 2014/08/05 12:15:00  0 1.1495      22.028 2014-08-05 12:15:00 2014   8
##   wk DOY hr
## 1 31 217 11
## 2 31 217 11
## 3 31 217 11
## 4 31 217 11
## 5 31 217 12
## 6 31 217 12</code></pre>
<pre><code>## `summarise_each()` is deprecated.
## Use `summarise_all()`, `summarise_at()` or `summarise_if()` instead.
## To map `funs` over all variables, use `summarise_all()`</code></pre>
<p><img src="lesson_lubridate_files/figure-html/solution2-1.png" width="672" /><img src="lesson_lubridate_files/figure-html/solution2-2.png" width="672" /></p>
<pre><code>## `summarise_each()` is deprecated.
## Use `summarise_all()`, `summarise_at()` or `summarise_if()` instead.
## To map `funs` over all variables, use `summarise_all()`</code></pre>
<p><img src="lesson_lubridate_files/figure-html/solution2-3.png" width="672" /></p>
<p>This lesson was contributed by <a href="https://ryanpeek.github.io/">Ryan Peek</a>.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

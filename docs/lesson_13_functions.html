<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Creating functions</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    About
  </a>
</li>
<li>
  <a href="syllabus.html">
    <span class="fa fa-map fa-1x"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Set Up
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="computer_setup.html">Computer Setup</a>
    </li>
    <li>
      <a href="setting_up_git.html">Setting up Git Repository</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book  fa-1x"></span>
     
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_01_intro_r_rstudio.html">Intro to Programming, R, &amp; RStudio</a>
    </li>
    <li>
      <a href="lesson_02_project_management.html">Project Management</a>
    </li>
    <li>
      <a href="lesson_03_how_r_thinks_about_data.html">How R Thinks About Data</a>
    </li>
    <li>
      <a href="lesson_04_spreadsheets_condensed.html">Spreadsheets</a>
    </li>
    <li>
      <a href="lesson_05_data_import.html">Starting With Spreadsheets in R</a>
    </li>
    <li>
      <a href="lesson_06_data_manipulation_pt1.html">Data Manipulation Pt1</a>
    </li>
    <li>
      <a href="lesson_08_data_manipulation_pt2.html">Data Manipulation Pt2</a>
    </li>
    <li>
      <a href="lesson_09_data_viz_pt1.html">Data Visualization Pt1</a>
    </li>
    <li>
      <a href="lesson_11_data_viz_pt2.html">Data Visualization Pt2</a>
    </li>
    <li>
      <a href="lesson_12_lubridate.html">Date-times with lubridate</a>
    </li>
    <li>
      <a href="lesson_13_functions.html">Writing functions</a>
    </li>
    <li>
      <a href="lesson_14_iteration.html">Iteration</a>
    </li>
    <li>
      <a href="lesson_rmarkdown.html">Literate Programming with RMarkdown</a>
    </li>
  </ul>
</li>
<li>
  <a href="lectures.html">
    <span class="fa fa-slideshare fa-1x"></span>
     
    Lectures
  </a>
</li>
<li>
  <a href="assignments.html">
    <span class="fa fa-paperclip fa-1x"></span>
     
    Assignments
  </a>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-list"></span>
     
    Resources
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://github.com/gge-ucd/R-DAVIS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Creating functions</h1>

</div>


<div id="learning-objectives" class="section level3 blue">
<h3>Learning objectives</h3>
<ul>
<li>Define a function that takes arguments.</li>
<li>Set default values for function arguments.</li>
<li>Explain why we should divide programs into small, single-purpose
functions.</li>
</ul>
</div>
<p><br></p>
<p>Any operation you will perform more than once can be put into a
function. That way, rather than retyping all the commands (and
potentially making errors), you can simply call the function, passing it
a new dataset or parameters. This may seem cumbersome at first, but
writing functions to automate repetitive tasks is incredibly powerful.
E.g. each time you call <code>ggplot</code> you are calling a function
that someone wrote. Imagine if each time you wanted to make a plot you
had to copy and paste or write that code from scratch!</p>
<div id="defining-a-function" class="section level2">
<h2>Defining a function</h2>
<p>Recall the components of a function. E.g. the <code>log</code>
function (see <code>?log</code>) takes “arguments” <code>x</code> and
<code>base</code> and “returns” the base-<code>base</code> logarithm of
<code>x</code>. Functions take arguments as input and yield
return-values as output. You can define functions to do any number of
operations on any number of arguments, but always output a single return
value (however there are complex objects into which you can put multiple
objects, should you need to).</p>
<p>Let’s start by defining a simple function to add two numbers. This is
the basic structure, which you can read as “assign to the variable
<code>my_sum</code> a function that takes arguments <code>a</code> and
<code>b</code> and returns <code>the_sum</code>.” The body of the
function is delimited by the curly-braces. The statements in the body
are indented. This makes the code easier to read but does not affect how
the code operates.</p>
<pre class="r"><code>my_sum &lt;- function(a, b) {
  the_sum &lt;- a + b
  return(the_sum)
}</code></pre>
<p>Notice that no numbers were summed when we ran that code, but now the
Environment has an object called <code>my_sum</code> that has type
function. You can call <code>my_sum</code> just like you would any other
function. When you do, the code between the curly-braces of the
<code>my_sum</code> definition is run with whatever values you pass to
<code>a</code> and <code>b</code> substituted in their place.</p>
<pre class="r"><code>my_sum(a = 2, b = 2)</code></pre>
<pre><code>## [1] 4</code></pre>
<pre class="r"><code>my_sum(3, 4)</code></pre>
<pre><code>## [1] 7</code></pre>
<p>Just like <code>log</code> provides a default value of
<code>base</code> (<code>exp(1)</code>) so that you don’t have to type
it every time, you can provide default values to any arguments of your
function. Then if the user doesn’t specify them, the defaults will be
used.</p>
<pre class="r"><code>my_sum2 &lt;- function(a = 1, b = 2) {
  the_sum &lt;- a + b
  return(the_sum)
}
my_sum2()</code></pre>
<pre><code>## [1] 3</code></pre>
<pre class="r"><code>my_sum2(b = 7)</code></pre>
<pre><code>## [1] 8</code></pre>
<div id="tip" class="section level3 blue">
<h3>Tip</h3>
<p>One feature unique to R is that the return statement is not required.
R automatically returns the output of the last line of the body of the
function unless a <code>return</code> statement is specified elsewhere.
Since other languages require a <code>return</code> statement and
because it can make reading a function easier, we will explicitly define
the return statement.</p>
</div>
<p><br></p>
</div>
<div id="temperature-conversion" class="section level2">
<h2>Temperature conversion</h2>
<p>Let’s define a function F_to_K that converts temperatures from
Fahrenheit to Kelvin:</p>
<pre class="r"><code>F_to_K &lt;- function(temp) {
  K &lt;- ((temp - 32) * (5 / 9)) + 273.15
  return(K)
}</code></pre>
<p>Calling our own function is no different from calling any other
function:</p>
<pre class="r"><code># freezing point of water
F_to_K(32)</code></pre>
<pre><code>## [1] 273.15</code></pre>
<pre class="r"><code># boiling point of water
F_to_K(212)</code></pre>
<pre><code>## [1] 373.15</code></pre>
<div id="challenge" class="section level3 blue">
<h3>Challenge</h3>
<ul>
<li>Write a function called <code>K_to_C</code> that takes a temperature
in K and returns that temperature in C
<ul>
<li>Hint: To convert from K to C you subtract 273.15</li>
</ul></li>
<li>Create a new R script, copy <code>F_to_K</code> and
<code>K_to_C</code> in it, and save it as functions.R in the
<code>code</code> directory of your project.</li>
</ul>
<details>
<summary>
ANSWER
</summary>
<pre class="r"><code>K_to_C &lt;- function(tempK) {
    tempC &lt;- tempK - 273.15 
    return(tempC)
}</code></pre>
</details>
</div>
<p><br></p>
</div>
<div id="sourceing-functions" class="section level2">
<h2><code>source()</code>ing functions</h2>
<p>You can load all the functions in your <code>code/functions.R</code>
script without even opening the file, via the <code>source</code>
function. This allows you to keep your functions separate from the
analyses which use them.</p>
<pre class="r"><code>source(&#39;code/functions.R&#39;)</code></pre>
<div id="using-dataframes-in-functions" class="section level3">
<h3>Using dataframes in functions</h3>
<p>Let’s write a function to calculate the average GDP in a given
country, in a given span of years, based on the <code>gapminder</code>
data. If you were to do this for just one specification, without writing
a function, it might look something like this:</p>
<pre class="r"><code>library(gapminder)
library(tidyverse)</code></pre>
<pre><code>## Warning: package &#39;tidyverse&#39; was built under R version 4.1.2</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ ggplot2 3.3.5      ✔ purrr   0.3.5 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.4.1 
## ✔ readr   2.1.2      ✔ forcats 0.5.1</code></pre>
<pre><code>## Warning: package &#39;tibble&#39; was built under R version 4.1.2</code></pre>
<pre><code>## Warning: package &#39;tidyr&#39; was built under R version 4.1.2</code></pre>
<pre><code>## Warning: package &#39;readr&#39; was built under R version 4.1.2</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 4.1.2</code></pre>
<pre><code>## Warning: package &#39;stringr&#39; was built under R version 4.1.2</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>gapminder %&gt;% 
  filter(country == &quot;Canada&quot;, year %in% c(1950:1970)) %&gt;% 
  summarize(mean(gdpPercap, na.rm = T))</code></pre>
<pre><code>## # A tibble: 1 × 1
##   `mean(gdpPercap, na.rm = T)`
##                          &lt;dbl&gt;
## 1                       13349.</code></pre>
<p>But, what if you wanted to do this for many different specifications?
You might find yourself wanting to copy and paste these couple lines of
code over and over. Instead, you can write it into a function,
<strong>soft coding</strong> the parts that you want as your function’s
arguments. In this example, we want to be able to change the country and
the year range that we are interested in.</p>
<pre class="r"><code># Note: try to name arguments something that do not exist as a column name, to avoid confusing yourself and R
avgGDP &lt;- function(cntry, yr.range){
  df &lt;- gapminder %&gt;% 
  filter(country == cntry, year %in% yr.range)
  mean(df$gdpPercap, na.rm = T)
}

avgGDP(&quot;Iran&quot;, 1980:1985)</code></pre>
<pre><code>## [1] 7608.335</code></pre>
<pre class="r"><code>avgGDP(&quot;Zimbabwe&quot;, 1950:2000)</code></pre>
<pre><code>## [1] 648.8549</code></pre>
</div>
</div>
<div id="pass-by-value" class="section level2">
<h2>Pass by value</h2>
<p>Functions in R almost always make copies of the data to operate on
inside of a function body. When we modify a data frame inside the
function we are modifying the copy of the gapminder dataset, not the
original variable we gave as the first argument. This is called
“pass-by-value” and it makes writing code much safer: you can always be
sure that whatever changes you make within the body of the function,
stay inside the body of the function.</p>
<div id="challenge-1" class="section level3 challenge blue">
<h3 class="challenge">Challenge</h3>
<p>This challenge will deal with countries’ population growth. To access
the data, load (and install, if needed) the <code>gapminder</code>
library and access its life expectancy dataset using:</p>
<pre><code>library(gapminder)
d &lt;- gapminder::gapminder</code></pre>
<p>Write a new function that takes two arguments, the gapminder
data.frame (<code>d</code>) and the name of a country
(e.g. <code>"Afghanistan"</code>), and plots a time series of the
country’s population. The return value from the function should be a
ggplot object. Note: It is often easier to modify existing code than to
start from scratch. To start out with one plot for a particular country,
figured out what you need to change for each iteration (these will be
your arguments), and then wrap it in a function.</p>
<details>
<summary>
ANSWER
</summary>
<pre class="r"><code>plotPopGrowth &lt;- function(countrytoplot, dat = gapminder) {
    df &lt;- filter(dat, country == countrytoplot) 
    plot &lt;- ggplot(df, aes(year, pop)) + 
        geom_line()
    return(plot)
}
plotPopGrowth(&#39;Canada&#39;)</code></pre>
<img src="lesson_13_functions_files/figure-html/unnamed-chunk-11-1.png" width="672" />
</details>
</div>
<p><br></p>
<p>This lesson is adapted from the Software Carpentry: R for
Reproducible Scientific Analysis <a
href="http://data-lessons.github.io/gapminder-R/07-functions.html">Creating
Functions materials</a>.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>R for reproducible scientific analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="stylesheet" href="site_libs_extra/academicons-1.8.0/css/academicons.css"/>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info-circle  fa-1x"></span>
     
    About
  </a>
</li>
<li>
  <a href="syllabus.html">
    <span class="fa fa-map fa-1x"></span>
     
    Syllabus
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Set Up!
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="computer_setup.html">Computer Setup</a>
    </li>
    <li>
      <a href="setting_up_git.html">Setting up Git Repository</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book  fa-1x"></span>
     
    Course Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lesson_intro_r_rstudio.html">Orientation to Programming, R, &amp; RStudio</a>
    </li>
    <li>
      <a href="lesson_project_management.html">Project Management</a>
    </li>
    <li>
      <a href="lesson_spreadsheets_condensed.html">Spreadsheets</a>
    </li>
    <li>
      <a href="lesson_vectors.html">Vectors &amp; Data Types</a>
    </li>
    <li>
      <a href="lesson_data_frames_ecology.html">Data Frames</a>
    </li>
    <li>
      <a href="lesson_dplyr_ecology.html">Using dplyr</a>
    </li>
    <li>
      <a href="lesson_ggplot_ecology.html">Using ggplot2</a>
    </li>
    <li>
      <a href="lesson_data_import.html">Data Import &amp; Export</a>
    </li>
    <li>
      <a href="lesson_visualization_dos.html">Visualization Do's &amp; Don'ts</a>
    </li>
    <li>
      <a href="lesson_rmarkdown.html">Literate Programming with RMarkdown</a>
    </li>
    <li>
      <a href="lesson_tidyr.html">Using tidyr</a>
    </li>
    <li>
      <a href="lesson_lubridate.html">Times &amp; Dates with lubridate</a>
    </li>
    <li>
      <a href="lesson_functions.html">Writing functions</a>
    </li>
    <li>
      <a href="lesson_iteration.html">Iteration</a>
    </li>
  </ul>
</li>
<li>
  <a href="lectures.html">
    <span class="fa fa-slideshare fa-1x"></span>
     
    Lectures
  </a>
</li>
<li>
  <a href="assignments.html">
    <span class="fa fa-paperclip fa-1x"></span>
     
    Assignments
  </a>
</li>
<li>
  <a href="resources.html">
    <span class="fa fa-list"></span>
     
    Resources
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-hand-spock-o"></span>
     
    Contact
  </a>
</li>
<li>
  <a href="https://github.com/gge-ucd/R-DAVIS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">R for reproducible scientific analysis</h1>
<h3 class="subtitle"><em>Creating functions</em></h3>

</div>


<blockquote>
<h2 id="learning-objectives" class="objectives">Learning objectives</h2>
<ul>
<li>Define a function that takes arguments.</li>
<li>Return a value from a function.</li>
<li>Test a function.</li>
<li>Set default values for function arguments.</li>
<li>Explain why we should divide programs into small, single-purpose functions.</li>
</ul>
</blockquote>
<p>Any operation you will perform more than once can be put into a function. That way, rather than retyping all the commands (and potentially making errors), you can simply call the function, passing it a new dataset or parameters. This may seem cumbersome at first, but writing functions to automate repetitive tasks is incredibly powerful. E.g. each time you call <code>ggplot</code> you are calling a function that someone wrote. Imagine if each time you wanted to make a plot you had to copy and paste or write that code from scratch!</p>
<div id="defining-a-function" class="section level3">
<h3>Defining a function</h3>
<p>Recall the components of a function. E.g. the <code>log</code> function (see <code>?log</code>) takes “arguments” <code>x</code> and <code>base</code> and “returns” the base-<code>base</code> logarithm of <code>x</code>. Functions take arguments as input and yield return-values as output. You can define functions to do any number of operations on any number of arguments, but always output a single return value (however there are complex objects into which you can put multiple objects, should you need to).</p>
<p>Let’s start by defining a simple function to add two numbers. This is the basic structure, which you can read as “assign to the variable <code>my_sum</code> a function that takes arguments <code>a</code> and <code>b</code> and returns <code>the_sum</code>.” The body of the function is delimited by the curly-braces. The statements in the body are indented. This makes the code easier to read but does not affect how the code operates.</p>
<pre class="r"><code>my_sum &lt;- function(a, b) {
  the_sum &lt;- a + b
  return(the_sum)
}</code></pre>
<p>Notice that no numbers were summed when we ran that code, but now the Environment has an object called <code>my_sum</code> that has type function. You can call <code>my_sum</code> just like you would any other function. When you do, the code between the curly-braces of the <code>my_sum</code> definition is run with whatever values you pass to <code>a</code> and <code>b</code> substituted in their place.</p>
<pre class="r"><code>my_sum(a = 2, b = 2)</code></pre>
<pre><code>## [1] 4</code></pre>
<pre class="r"><code>my_sum(3, 4)</code></pre>
<pre><code>## [1] 7</code></pre>
<p>Just like <code>log</code> provides a default value of <code>base</code> (<code>exp(1)</code>) so that you don’t have to type it every time, you can provide default values to any arguments of your function. Then if the user doesn’t specify them, the defaults will be used.</p>
<pre class="r"><code>my_sum2 &lt;- function(a = 1, b = 2) {
  the_sum &lt;- a + b
  return(the_sum)
}
my_sum2()</code></pre>
<pre><code>## [1] 3</code></pre>
<pre class="r"><code>my_sum2(b = 7)</code></pre>
<pre><code>## [1] 8</code></pre>
<blockquote>
<h2 id="tip" class="callout">Tip</h2>
<p>One feature unique to R is that the return statement is not required. R automatically returns the output of the last line of the body of the function unless a <code>return</code> statement is specified elsewhere. Since other languages require a <code>return</code> statement and because it can make reading a function easier, we will explicitly define the return statement.</p>
</blockquote>
<div id="temperature-conversion" class="section level4">
<h4>Temperature conversion</h4>
<p>Let’s define a function F_to_K that converts temperatures from Fahrenheit to Kelvin:</p>
<pre class="r"><code>F_to_K &lt;- function(temp) {
  K &lt;- ((temp - 32) * (5 / 9)) + 273.15
  return(K)
}</code></pre>
<p>Calling our own function is no different from calling any other function:</p>
<pre class="r"><code># freezing point of water
F_to_K(32)</code></pre>
<pre><code>## [1] 273.15</code></pre>
<pre class="r"><code># boiling point of water
F_to_K(212)</code></pre>
<pre><code>## [1] 373.15</code></pre>
<blockquote>
<h4 id="challenge-1" class="challenge">Challenge 1</h4>
<ul>
<li>Write a function called <code>K_to_C</code> that takes a temperature in K and returns that temperature in C
<ul>
<li>Hint: To convert from K to C you subtract 273.15</li>
</ul></li>
<li>Create a new R script, copy <code>F_to_K</code> and <code>K_to_C</code> in it, and save it as functions.R in the <code>code</code> directory of your project.</li>
</ul>
</blockquote>
</div>
<div id="sourceing-functions" class="section level4">
<h4><code>source()</code>ing functions</h4>
<p>You can load all the functions in your <code>code/functions.R</code> script without even opening the file, via the <code>source</code> function. This allows you to keep your functions separate from the analyses which use them.</p>
<pre class="r"><code>source(&#39;code/functions.R&#39;)</code></pre>
</div>
<div id="combining-functions" class="section level4">
<h4>Combining functions</h4>
<p>The real power of functions comes from mixing, matching and combining them into ever large chunks to get the effect we want.</p>
<blockquote>
<h4 id="challenge-2" class="challenge">Challenge 2</h4>
<ul>
<li>Write a new function called <code>F_to_C</code> in your functions.R file that converts temperature directly from F to C by reusing the two functions above.</li>
<li>Load the function not by highlighting the code but by <code>source</code>-ing your functions.R file.</li>
<li>Use the function to find today’s high temperature in your location in C.</li>
</ul>
</blockquote>
</div>
</div>
<div id="a-more-useful-function" class="section level3">
<h3>A more-useful function</h3>
<p>Let’s write a function to calculate countries’ GDPs in their local currency.</p>
<ul>
<li><p>Start with Canada, exchange rate is 1.279098</p></li>
<li><p>Turn that into a function that takes country and exchange rate.</p></li>
<li><p>Here is a <a href="https://raw.githubusercontent.com/michaellevy/gapminder-R/gh-pages/data/simple_exchange_rate.csv">table of exchange rates for many countries</a>.</p></li>
<li><p>Call the function with some row</p></li>
<li><p>lapply over rows</p></li>
</ul>
</div>
<div id="do-by-joins" class="section level3">
<h3>Do by joins</h3>
<p>And by year</p>
<ul>
<li><p>Get all the exchange rates over time. You can <a href="https://raw.githubusercontent.com/michaellevy/gapminder-R/gh-pages/data/exchange_rate.csv">download that here</a>.</p></li>
<li><p>join, filter</p></li>
</ul>
<blockquote>
<h4 id="tip-pass-by-value" class="callout">Tip: Pass by value</h4>
<p>Functions in R almost always make copies of the data to operate on inside of a function body. When we modify <code>dat</code> inside the function we are modifying the copy of the gapminder dataset stored in <code>dat</code>, not the original variable we gave as the first argument.</p>
<p>This is called “pass-by-value” and it makes writing code much safer: you can always be sure that whatever changes you make within the body of the function, stay inside the body of the function.</p>
</blockquote>
<blockquote>
<h4 id="tip-function-scope" class="callout">Tip: Function scope</h4>
<p>A related concept is scoping: any variables you create or modify inside the body of a function only exist for the lifetime of the function’s execution. When we call <code>calcGDP</code>, the variables <code>dat</code>, <code>years</code>, and <code>filteredDF</code> only exist inside the body of the function. Even if we have variables of the same name in our interactive R session, they are not modified in any way when executing a function.</p>
</blockquote>
<blockquote>
<h4 id="challenge-a-new-function" class="challenge">Challenge – A new function</h4>
<p>Write a new function that takes two arguments, the gapminder data.frame and the name of a country, and plots the change in the country’s population over time. That is, the return value from the function should be a ggplot object. - It is often easier to modify existing code than to start from scratch. Feel free to start with the calcGDP function code.</p>
</blockquote>
</div>
<div id="challenge-solutions" class="section level3">
<h3>Challenge solutions</h3>
<blockquote>
<h4 id="solution-a-new-function" class="challenge">Solution – A new function</h4>
<pre class="r"><code>plotPopGrowth &lt;- function(countrytoplot, dat = gapminder) {
    df &lt;- filter(dat, country == countrytoplot) 
    plot &lt;- ggplot(df, aes(year, pop)) + 
        geom_line()
    return(plot)
}
plotPopGrowth(&#39;Canada&#39;)</code></pre>
<p><img src="lesson_functions_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</blockquote>
<p><br></p>
<p>This lesson is adapted from the Software Carpentry: R for Reproducible Scientific Analysis <a href="http://data-lessons.github.io/gapminder-R/07-functions.html">Creating Functions materials</a>.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
